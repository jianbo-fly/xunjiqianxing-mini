<!-- 登录页面 -->
<view class="page-login">
  <!-- 步骤一：欢迎页 -->
  <view class="step step-welcome" wx:if="{{step === 1}}">
    <!-- Logo区域 -->
    <view class="logo-area">
      <image class="logo" src="/assets/images/logo.png" mode="aspectFit" />
      <text class="app-name">寻迹千行</text>
      <text class="app-slogan">发现旅途中的美好</text>
    </view>

    <!-- 登录按钮区域 -->
    <view class="login-area">
      <button
        class="btn-login btn-wx"
        loading="{{logging}}"
        bindtap="handleWxLogin"
      >
        <text class="btn-icon">微信</text>
        <text>微信一键登录</text>
      </button>

      <!-- 协议勾选 -->
      <view class="agreement">
        <view class="checkbox {{agreed ? 'checked' : ''}}" bindtap="handleAgreeChange">
          <text wx:if="{{agreed}}">✓</text>
        </view>
        <text class="agreement-text">
          我已阅读并同意
          <text class="link" bindtap="handleViewAgreement">《用户协议》</text>
          和
          <text class="link" bindtap="handleViewPrivacy">《隐私政策》</text>
        </text>
      </view>
    </view>
  </view>

  <!-- 步骤二：完善信息 -->
  <view class="step step-profile" wx:if="{{step === 2}}">
    <view class="step-header">
      <text class="step-title">完善个人信息</text>
      <text class="step-desc">设置头像和昵称，让大家认识你</text>
    </view>

    <view class="profile-form">
      <!-- 头像选择 -->
      <view class="form-item avatar-item">
        <text class="form-label">头像</text>
        <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="handleChooseAvatar">
          <image
            class="avatar-preview"
            src="{{userInfo.avatar || '/assets/images/placeholder/avatar.png'}}"
            mode="aspectFill"
          />
          <text class="avatar-tip">点击更换</text>
        </button>
      </view>

      <!-- 昵称输入 -->
      <view class="form-item">
        <text class="form-label">昵称</text>
        <input
          class="form-input"
          type="nickname"
          placeholder="请输入昵称"
          value="{{userInfo.nickname}}"
          bindinput="handleNicknameInput"
        />
      </view>
    </view>

    <view class="step-actions">
      <button
        class="btn-primary"
        loading="{{submitting}}"
        bindtap="handleSubmitProfile"
      >
        下一步
      </button>
    </view>
  </view>

  <!-- 步骤三：绑定手机号 -->
  <view class="step step-phone" wx:if="{{step === 3}}">
    <view class="step-header">
      <text class="step-title">绑定手机号</text>
      <text class="step-desc">绑定手机号，保障账号安全</text>
    </view>

    <view class="phone-form">
      <!-- 微信一键获取 -->
      <button
        class="btn-phone-wx"
        open-type="getPhoneNumber"
        bindgetphonenumber="handleGetPhoneNumber"
        loading="{{submitting}}"
      >
        <text class="btn-icon">手机</text>
        <text>微信一键获取手机号</text>
      </button>

      <view class="divider">
        <text class="divider-line"></text>
        <text class="divider-text">或手动输入</text>
        <text class="divider-line"></text>
      </view>

      <!-- 手动输入手机号 -->
      <view class="form-item">
        <input
          class="form-input"
          type="number"
          maxlength="11"
          placeholder="请输入手机号"
          value="{{phone}}"
          bindinput="handlePhoneInput"
        />
      </view>

      <!-- 验证码 -->
      <view class="form-item code-item">
        <input
          class="form-input"
          type="number"
          maxlength="6"
          placeholder="请输入验证码"
          value="{{verifyCode}}"
          bindinput="handleCodeInput"
        />
        <button
          class="btn-code {{countdown > 0 ? 'disabled' : ''}}"
          disabled="{{countdown > 0}}"
          bindtap="handleSendCode"
        >
          {{countdown > 0 ? countdown + 's' : '获取验证码'}}
        </button>
      </view>

      <button
        class="btn-primary"
        loading="{{submitting}}"
        bindtap="handleBindPhone"
      >
        绑定手机号
      </button>
    </view>

    <!-- 跳过 -->
    <view wx:if="{{canSkipPhone}}" class="skip-area">
      <text class="skip-btn" bindtap="handleSkipPhone">暂时跳过</text>
    </view>
  </view>

  <!-- 底部说明 -->
  <view class="footer">
    <text class="footer-text">登录即表示您同意我们的服务条款</text>
  </view>
</view>
