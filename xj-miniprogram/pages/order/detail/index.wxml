<!--
  è®¢å•è¯¦æƒ…é¡µ
-->
<view class="page-order-detail" wx:if="{{!loading && order}}">
  <!-- è®¢å•çŠ¶æ€åŒº -->
  <view class="status-section status-{{order.status}}">
    <view class="status-icon">
      <text wx:if="{{order.status === 0}}">â°</text>
      <text wx:elif="{{order.status === 1 || order.status === 2}}">âœ…</text>
      <text wx:elif="{{order.status === 3}}">ğŸš—</text>
      <text wx:elif="{{order.status === 4}}">ğŸ‰</text>
      <text wx:elif="{{order.status === 5 || order.status === 8}}">âŒ</text>
      <text wx:elif="{{order.status === 6}}">â³</text>
      <text wx:elif="{{order.status === 7}}">ğŸ’°</text>
    </view>
    <view class="status-text">{{order.statusText}}</view>
    <view class="status-tip">{{order.statusTip}}</view>
    <view class="countdown" wx:if="{{order.status === 0 && countdown}}">
      <text>å‰©ä½™æ”¯ä»˜æ—¶é—´: </text>
      <text class="countdown-time">{{countdown}}</text>
    </view>
  </view>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="section product-section" bindtap="handleViewProduct">
    <image class="product-image" src="{{order.productImage}}" mode="aspectFill"></image>
    <view class="product-info">
      <view class="product-name">{{order.productName}}</view>
      <view class="product-sku">{{order.skuName}}</view>
      <view class="product-date">
        <text class="date-label">å‡ºå‘æ—¥æœŸ</text>
        <text class="date-value">{{order.startDateText}}</text>
      </view>
    </view>
    <view class="arrow-icon">â€º</view>
  </view>

  <!-- å‡ºè¡Œäººä¿¡æ¯ -->
  <view class="section traveler-section">
    <view class="section-title">å‡ºè¡Œäººä¿¡æ¯</view>

    <!-- æˆäººå‡ºè¡Œäºº -->
    <view class="traveler-group" wx:if="{{order.adultTravelers.length > 0}}">
      <view class="group-label">æˆäºº ({{order.adultTravelers.length}}äºº)</view>
      <view class="traveler-item" wx:for="{{order.adultTravelers}}" wx:key="index">
        <view class="traveler-name">{{item.name}}</view>
        <view class="traveler-info">
          <text class="info-label">è¯ä»¶å·</text>
          <text class="info-value">{{item.idCard}}</text>
        </view>
        <view class="traveler-info" wx:if="{{item.phone}}">
          <text class="info-label">æ‰‹æœºå·</text>
          <text class="info-value">{{item.phone}}</text>
        </view>
      </view>
    </view>

    <!-- å„¿ç«¥å‡ºè¡Œäºº -->
    <view class="traveler-group" wx:if="{{order.childTravelers.length > 0}}">
      <view class="group-label">å„¿ç«¥ ({{order.childTravelers.length}}äºº)</view>
      <view class="traveler-item" wx:for="{{order.childTravelers}}" wx:key="index">
        <view class="traveler-name">{{item.name}}</view>
        <view class="traveler-info">
          <text class="info-label">è¯ä»¶å·</text>
          <text class="info-value">{{item.idCard}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è”ç³»äººä¿¡æ¯ -->
  <view class="section contact-section">
    <view class="section-title">è”ç³»äººä¿¡æ¯</view>
    <view class="contact-row">
      <text class="contact-label">è”ç³»äºº</text>
      <text class="contact-value">{{order.contactName}}</text>
    </view>
    <view class="contact-row">
      <text class="contact-label">æ‰‹æœºå·</text>
      <text class="contact-value">{{order.contactPhone}}</text>
    </view>
  </view>

  <!-- ä»·æ ¼æ˜ç»† -->
  <view class="section price-section">
    <view class="section-title">ä»·æ ¼æ˜ç»†</view>
    <view class="price-row">
      <text class="price-label">æˆäºº Â¥{{order.adultPriceText}} Ã— {{order.adultCount}}</text>
      <text class="price-value">Â¥{{order.adultTotalText}}</text>
    </view>
    <view class="price-row" wx:if="{{order.childCount > 0}}">
      <text class="price-label">å„¿ç«¥ Â¥{{order.childPriceText}} Ã— {{order.childCount}}</text>
      <text class="price-value">Â¥{{order.childTotalText}}</text>
    </view>
    <view class="price-row" wx:if="{{order.discountAmount > 0}}">
      <text class="price-label">ä¼˜æƒ </text>
      <text class="price-value discount">-Â¥{{order.discountAmountText}}</text>
    </view>
    <view class="price-total">
      <text class="total-label">å®ä»˜é‡‘é¢</text>
      <text class="total-value">Â¥{{order.payAmountText}}</text>
    </view>
  </view>

  <!-- è®¢å•ä¿¡æ¯ -->
  <view class="section order-info-section">
    <view class="section-title">è®¢å•ä¿¡æ¯</view>
    <view class="info-row">
      <text class="info-label">è®¢å•ç¼–å·</text>
      <view class="info-value-wrap">
        <text class="info-value">{{order.orderNo}}</text>
        <text class="copy-btn" bindtap="handleCopyOrderNo">å¤åˆ¶</text>
      </view>
    </view>
    <view class="info-row">
      <text class="info-label">ä¸‹å•æ—¶é—´</text>
      <text class="info-value">{{order.createdAtText}}</text>
    </view>
    <view class="info-row" wx:if="{{order.payTimeText}}">
      <text class="info-label">æ”¯ä»˜æ—¶é—´</text>
      <text class="info-value">{{order.payTimeText}}</text>
    </view>
    <view class="info-row" wx:if="{{order.remark}}">
      <text class="info-label">å¤‡æ³¨</text>
      <text class="info-value">{{order.remark}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="bottom-bar">
    <!-- å†æ¬¡è´­ä¹° -->
    <view class="btn btn-default" wx:if="{{order.showBuyAgainBtn}}" bindtap="handleBuyAgain">
      å†æ¬¡è´­ä¹°
    </view>
    <!-- è”ç³»å®¢æœ -->
    <view class="btn btn-default" wx:if="{{order.showContactBtn}}" bindtap="handleContact">
      è”ç³»å®¢æœ
    </view>
    <!-- ç”³è¯·é€€æ¬¾ -->
    <view class="btn btn-default" wx:if="{{order.showRefundBtn}}" bindtap="handleRefund">
      ç”³è¯·é€€æ¬¾
    </view>
    <!-- å–æ¶ˆè®¢å• -->
    <view class="btn btn-default" wx:if="{{order.showCancelBtn}}" bindtap="handleCancel">
      å–æ¶ˆè®¢å•
    </view>
    <!-- å»æ”¯ä»˜ -->
    <view class="btn btn-primary" wx:if="{{order.showPayBtn}}" bindtap="handlePay">
      ç«‹å³æ”¯ä»˜ Â¥{{order.payAmountText}}
    </view>
  </view>

  <!-- åº•éƒ¨å ä½ -->
  <view class="bottom-placeholder"></view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading-container" wx:if="{{loading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>
