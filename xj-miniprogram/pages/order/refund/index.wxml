<!--
  退款申请页
-->
<view class="page-refund" wx:if="{{!loading}}">
  <!-- 订单信息卡片 -->
  <view class="order-card" wx:if="{{order}}">
    <image class="order-image" src="{{order.productImage}}" mode="aspectFill" />
    <view class="order-info">
      <view class="order-name">{{order.productName}}</view>
      <view class="order-no">订单号：{{order.orderNo}}</view>
      <view class="order-bottom">
        <text class="order-date-tag" wx:if="{{order.startDateText}}">{{order.startDateText}}出发</text>
        <text class="order-price">¥ {{order.payAmountText}}</text>
      </view>
    </view>
  </view>

  <!-- 退款提示 -->
  <view class="refund-warning" wx:if="{{order.refundRule}}">
    <image class="warning-icon" src="/assets/icons/common/service.png" mode="aspectFit" />
    <text class="warning-text">{{order.refundRule.ruleDescription}}</text>
  </view>

  <!-- 退款金额明细 -->
  <view class="amount-section">
    <view class="amount-row">
      <text class="amount-label">订单总额</text>
      <text class="amount-value">¥ {{order.payAmountText}}</text>
    </view>
    <view class="amount-row" wx:if="{{order.refundRule.refundPercent < 100}}">
      <text class="amount-label">扣除手续费 ({{100 - order.refundRule.refundPercent}}%)</text>
      <text class="amount-value amount-deduct">- ¥ {{deductAmountText}}</text>
    </view>
    <view class="amount-row amount-row-total">
      <text class="amount-label-bold">预计退款金额</text>
      <text class="amount-total">¥ {{refundAmountText}}</text>
    </view>
    <view class="amount-tip">退款将原路退回至您的支付账户，预计1-3个工作日到账。</view>
  </view>

  <!-- 退款原因 -->
  <view class="reason-section">
    <view class="reason-title">退款原因 <text class="required">*</text></view>
    <view class="reason-tags">
      <view
        class="reason-tag {{selectedReasonIndex === index ? 'active' : ''}}"
        wx:for="{{reasonOptions}}"
        wx:key="index"
        data-index="{{index}}"
        bindtap="handleSelectReason"
      >{{item}}</view>
    </view>
  </view>

  <!-- 底部占位 -->
  <view class="bottom-placeholder"></view>
</view>

<!-- 底部固定操作栏 -->
<view class="bottom-bar" wx:if="{{!loading && order}}">
  <view class="bottom-price">
    <text class="bottom-price-label">退款总额</text>
    <text class="bottom-price-value">¥ {{refundAmountText}}</text>
  </view>
  <view
    class="bottom-submit {{submitting ? 'disabled' : ''}}"
    bindtap="handleSubmit"
  >
    {{submitting ? '提交中...' : '提交退款申请'}}
    <text wx:if="{{!submitting}}"> →</text>
  </view>
</view>

<!-- 加载中 -->
<view class="loading-container" wx:if="{{loading}}">
  <xj-loading text="加载中..." vertical />
</view>
