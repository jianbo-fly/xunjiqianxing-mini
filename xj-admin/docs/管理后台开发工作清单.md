# 管理后台（B端）开发工作清单

## 开发进度总览

| 阶段 | 模块 | 状态 | 预计工时 |
|------|------|------|----------|
| Phase 1 | 基础架构 + 认证 | ✅ 已完成 | 3天 |
| Phase 2 | 线路管理 | ✅ 已完成 | 5天 |
| Phase 3 | 订单管理 | ✅ 已完成 | 4天 |
| Phase 4 | 用户与会员管理 | ✅ 已完成 | 3天 |
| Phase 5 | 推广系统管理 | ✅ 已完成 | 3天 |
| Phase 6 | 内容与配置管理 | ✅ 已完成 | 2天 |
| Phase 7 | 数据统计 | ⏳ 待开发 | 2天 |

**总计预估**: 22 人天

---

## Phase 1：基础架构 + 认证 ✅ 已完成

### 1.1 项目配置
- [x] `application.yml` / `application-dev.yml` 配置
- [x] `SaTokenAdminConfig.java` - 认证拦截器配置
- [x] `OpenApiConfig.java` - API文档配置
- [x] `CorsConfig.java` - 跨域配置
- [x] `SaTokenExceptionHandler.java` - 认证异常处理

### 1.2 实体与数据层
- [x] `SystemAdmin.java` - 管理员实体
- [x] `SystemSupplier.java` - 供应商实体
- [x] `SystemAdminMapper.java`
- [x] `SystemSupplierMapper.java`

### 1.3 认证接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/auth/login` | POST | 登录（管理员/供应商） | ✅ |
| `/admin/auth/logout` | POST | 退出登录 | ✅ |
| `/admin/auth/userinfo` | GET | 获取当前用户信息 | ✅ |
| `/admin/auth/changePassword` | POST | 修改密码 | ✅ |
| `/admin/auth/initAdmin` | POST | 初始化管理员(开发用) | ✅ |

### 1.4 文件上传接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/file/upload` | POST | 上传单个文件 | ✅ |
| `/admin/file/uploadBatch` | POST | 批量上传文件 | ✅ |

---

## Phase 2：线路管理 ✅ 已完成

### 2.1 已创建的文件
```
controller/
  └── RouteController.java          # 线路管理接口 ✅

dto/route/
  └── RouteCreateRequest.java       # 创建线路请求 ✅
  └── RouteUpdateRequest.java       # 更新线路请求 ✅
  └── RouteQueryRequest.java        # 线路查询请求 ✅
  └── RouteDetailVO.java            # 线路详情响应 ✅
  └── RouteListVO.java              # 线路列表响应 ✅
  └── PackageCreateRequest.java     # 创建套餐请求 ✅
  └── PackageUpdateRequest.java     # 更新套餐请求 ✅
  └── PriceCalendarRequest.java     # 价格日历设置请求 ✅
  └── RouteAuditRequest.java        # 审核请求 ✅
  
service/
  └── AdminRouteService.java        # 线路管理服务 ✅
```

### 2.2 线路管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/route/list` | GET | 线路列表（分页/筛选） | ✅ |
| `/admin/route/{id}` | GET | 线路详情 | ✅ |
| `/admin/route` | POST | 创建线路 | ✅ |
| `/admin/route` | PUT | 更新线路 | ✅ |
| `/admin/route/{id}/status` | PUT | 上下架线路 | ✅ |
| `/admin/route/{id}` | DELETE | 删除线路 | ✅ |
| `/admin/route/audit` | POST | 审核线路 | ✅ |

### 2.3 套餐管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/route/{productId}/packages` | GET | 获取线路套餐列表 | ✅ |
| `/admin/route/package` | POST | 创建套餐 | ✅ |
| `/admin/route/package` | PUT | 更新套餐 | ✅ |
| `/admin/route/package/{id}` | DELETE | 删除套餐 | ✅ |
| `/admin/route/package/prices` | POST | 批量设置价格日历 | ✅ |
| `/admin/route/package/{skuId}/calendar` | GET | 获取价格日历 | ✅ |

### 2.4 业务逻辑
- [x] 线路创建时自动生成商品主表和扩展表记录
- [x] 供应商只能管理自己的线路
- [x] 线路审核通过后才能上架
- [x] 修改线路后需重新审核
- [x] 价格日历批量设置功能
- [x] 套餐创建/更新时自动更新线路最低价

---

## Phase 3：订单管理 ✅ 已完成

### 3.1 已创建的文件
```
controller/
  └── OrderController.java          # 订单管理接口 ✅
  └── RefundController.java         # 退款管理接口 ✅
  
dto/order/
  └── OrderQueryRequest.java        # 订单查询请求 ✅
  └── OrderListVO.java              # 订单列表响应 ✅
  └── OrderDetailVO.java            # 订单详情响应 ✅
  └── OrderConfirmRequest.java      # 确认/驳回请求 ✅
  └── OrderRemarkRequest.java       # 备注请求 ✅
  └── OrderStatsVO.java             # 统计响应 ✅
  └── RefundQueryRequest.java       # 退款查询请求 ✅
  └── RefundListVO.java             # 退款列表响应 ✅
  └── RefundAuditRequest.java       # 退款审核请求 ✅
  
service/
  └── AdminOrderService.java        # 订单管理服务 ✅
  └── AdminRefundService.java       # 退款管理服务 ✅

entity/ (xj-service-order)
  └── OrderRefund.java              # 退款实体 ✅

mapper/ (xj-service-order)
  └── OrderRefundMapper.java        # 退款Mapper ✅
```

### 3.2 订单管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/order/list` | GET | 订单列表（分页/筛选） | ✅ |
| `/admin/order/{orderNo}` | GET | 订单详情 | ✅ |
| `/admin/order/confirm` | POST | 确认/驳回订单 | ✅ |
| `/admin/order/remark` | POST | 添加备注 | ✅ |
| `/admin/order/stats` | GET | 订单统计数据 | ✅ |

### 3.3 退款管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/refund/list` | GET | 退款申请列表 | ✅ |
| `/admin/refund/{id}` | GET | 退款详情 | ✅ |
| `/admin/refund/audit` | POST | 审核退款（通过/驳回） | ✅ |
| `/admin/refund/pendingCount` | GET | 待审核数量 | ✅ |

### 3.4 业务逻辑
- [x] 供应商只能看到自己线路的订单
- [x] 订单状态流转控制（待确认→已确认/已取消）
- [x] 退款审核流程（审核通过/驳回）
- [x] 订单统计（各状态数量、今日/本月销售额）
- [x] 出行人信息脱敏显示

---

## Phase 4：用户与会员管理 ✅ 已完成

### 4.1 已创建的文件
```
controller/
  └── UserController.java           # 用户管理接口 ✅
  └── MemberController.java         # 会员管理接口 ✅
  └── LeaderController.java         # 领队管理接口 ✅
  
dto/user/
  └── UserQueryRequest.java         # 用户查询请求 ✅
  └── UserListVO.java               # 用户列表响应 ✅
  └── UserDetailVO.java             # 用户详情响应 ✅
  └── PointsAdjustRequest.java      # 积分调整请求 ✅
  └── MemberQueryRequest.java       # 会员查询请求 ✅
  └── MemberListVO.java             # 会员列表响应 ✅
  └── MemberExtendRequest.java      # 延长会员请求 ✅
  └── LeaderApplyQueryRequest.java  # 申请查询请求 ✅
  └── LeaderApplyVO.java            # 领队申请响应 ✅
  └── LeaderApplyAuditRequest.java  # 申请审核请求 ✅
  └── LeaderListVO.java             # 领队列表响应 ✅
  
service/
  └── AdminUserService.java         # 用户管理服务 ✅
  └── AdminMemberService.java       # 会员管理服务 ✅
  └── AdminLeaderService.java       # 领队管理服务 ✅

entity/ (xj-service-member)
  └── LeaderInfo.java               # 领队信息实体 ✅
  └── LeaderApply.java              # 领队申请实体 ✅

mapper/ (xj-service-member)
  └── LeaderInfoMapper.java         # 领队信息Mapper ✅
  └── LeaderApplyMapper.java        # 领队申请Mapper ✅
```

### 4.2 用户管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/user/list` | GET | 用户列表（分页/筛选） | ✅ |
| `/admin/user/{id}` | GET | 用户详情 | ✅ |
| `/admin/user/{id}/status` | PUT | 禁用/启用用户 | ✅ |
| `/admin/user/points/adjust` | POST | 调整积分 | ✅ |

### 4.3 会员管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/member/list` | GET | 会员列表（分页/筛选） | ✅ |
| `/admin/member/extend` | POST | 延长会员时间 | ✅ |
| `/admin/member/stats` | GET | 会员统计 | ✅ |

### 4.4 领队管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/leader/applies` | GET | 领队申请列表 | ✅ |
| `/admin/leader/applies/{id}` | GET | 申请详情 | ✅ |
| `/admin/leader/applies/audit` | POST | 审核申请 | ✅ |
| `/admin/leader/applies/pendingCount` | GET | 待审核数量 | ✅ |
| `/admin/leader/list` | GET | 领队列表 | ✅ |
| `/admin/leader/{id}/status` | PUT | 启用/禁用领队 | ✅ |

### 4.5 业务逻辑
- [x] 用户列表支持多条件筛选（会员/领队/推广员/状态）
- [x] 用户详情包含订单统计、消费总额、出行人数量
- [x] 积分调整支持增加和减少
- [x] 会员延期支持指定天数
- [x] 会员统计（总数/有效/过期/本月新增）
- [x] 领队申请审核流程（通过/驳回）
- [x] 审核通过自动创建领队信息并更新用户状态

---

## Phase 5：推广系统管理 ✅ 已完成

### 5.1 已创建的文件
```
controller/
  └── PromoterController.java       # 推广员管理接口 ✅
  └── CouponController.java         # 优惠券管理接口 ✅
  
dto/promotion/
  └── PromoterQueryRequest.java     # 推广员查询请求 ✅
  └── PromoterListVO.java           # 推广员列表响应 ✅
  └── PromoterDetailVO.java         # 推广员详情响应 ✅
  └── PromoterAuditRequest.java     # 推广员审核请求 ✅
  └── PromoterUpdateRequest.java    # 推广员更新请求 ✅
  └── BindLogVO.java                # 绑定记录响应 ✅
  └── CommissionVO.java             # 佣金记录响应 ✅
  └── CouponQueryRequest.java       # 优惠券查询请求 ✅
  └── CouponListVO.java             # 优惠券列表响应 ✅
  └── CouponCreateRequest.java      # 创建优惠券请求 ✅
  └── CouponUpdateRequest.java      # 更新优惠券请求 ✅
  └── CouponIssueRequest.java       # 发放优惠券请求 ✅
  └── UserCouponQueryRequest.java   # 用户券查询请求 ✅
  └── UserCouponVO.java             # 用户券响应 ✅
  
service/
  └── AdminPromoterService.java     # 推广员管理服务 ✅
  └── AdminCouponService.java       # 优惠券管理服务 ✅

entity/ (xj-service-promotion)
  └── PromoterBindLog.java          # 绑定记录实体 ✅

mapper/ (xj-service-promotion)
  └── PromoterBindLogMapper.java    # 绑定记录Mapper ✅
```

### 5.2 推广员管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/promoter/applies` | GET | 推广员申请列表 | ✅ |
| `/admin/promoter/applies/audit` | POST | 审核申请 | ✅ |
| `/admin/promoter/applies/pendingCount` | GET | 待审核数量 | ✅ |
| `/admin/promoter/list` | GET | 推广员列表 | ✅ |
| `/admin/promoter/{id}` | GET | 推广员详情 | ✅ |
| `/admin/promoter` | PUT | 更新推广员信息 | ✅ |
| `/admin/promoter/{id}/status` | PUT | 启用/禁用 | ✅ |
| `/admin/promoter/{id}/bindLogs` | GET | 绑定用户记录 | ✅ |
| `/admin/promoter/{id}/commissions` | GET | 佣金记录 | ✅ |

### 5.3 优惠券管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/coupon/templates` | GET | 优惠券模板列表 | ✅ |
| `/admin/coupon/template/{id}` | GET | 优惠券详情 | ✅ |
| `/admin/coupon/template` | POST | 创建优惠券模板 | ✅ |
| `/admin/coupon/template` | PUT | 更新模板 | ✅ |
| `/admin/coupon/template/{id}/status` | PUT | 启用/停用 | ✅ |
| `/admin/coupon/template/{id}` | DELETE | 删除模板 | ✅ |
| `/admin/coupon/issue` | POST | 发放优惠券 | ✅ |
| `/admin/coupon/records` | GET | 发放记录 | ✅ |
| `/admin/coupon/stats` | GET | 优惠券统计 | ✅ |

### 5.4 业务逻辑
- [x] 推广员申请审核流程（通过/驳回）
- [x] 审核通过时设置佣金比例和等级
- [x] 推广员等级管理（普通/银牌/金牌）
- [x] 推广员绑定用户记录查询
- [x] 推广员佣金记录查询
- [x] 优惠券模板管理（满减/折扣/无门槛）
- [x] 支持固定有效期和动态有效期
- [x] 优惠券批量发放（指定用户/全部会员）
- [x] 优惠券发放记录查询
- [x] 优惠券使用统计

---

## Phase 6：内容与配置管理 ✅ 已完成

### 6.1 已创建的文件
```
controller/
  └── BannerController.java         # Banner管理接口 ✅
  └── CategoryController.java       # 分类管理接口 ✅
  └── ConfigController.java         # 系统配置接口 ✅
  └── SupplierController.java       # 供应商管理接口 ✅
  
dto/content/
  └── BannerQueryRequest.java       # Banner查询请求 ✅
  └── BannerVO.java                 # Banner响应 ✅
  └── BannerCreateRequest.java      # 创建Banner请求 ✅
  └── BannerUpdateRequest.java      # 更新Banner请求 ✅
  └── CategoryVO.java               # 分类响应 ✅
  └── CategoryCreateRequest.java    # 创建分类请求 ✅
  └── CategoryUpdateRequest.java    # 更新分类请求 ✅
  └── SortRequest.java              # 排序请求 ✅

dto/system/
  └── SupplierQueryRequest.java     # 供应商查询请求 ✅
  └── SupplierVO.java               # 供应商响应 ✅
  └── SupplierCreateRequest.java    # 创建供应商请求 ✅
  └── SupplierUpdateRequest.java    # 更新供应商请求 ✅
  └── ConfigVO.java                 # 配置响应 ✅
  └── ConfigUpdateRequest.java      # 更新配置请求 ✅
  └── ConfigBatchUpdateRequest.java # 批量更新配置请求 ✅
  
service/
  └── AdminBannerService.java       # Banner管理服务 ✅
  └── AdminCategoryService.java     # 分类管理服务 ✅
  └── AdminConfigService.java       # 系统配置服务 ✅
  └── AdminSupplierService.java     # 供应商管理服务 ✅

entity/ (xj-service-content)
  └── Category.java                 # 分类实体 ✅

mapper/ (xj-service-content)
  └── CategoryMapper.java           # 分类Mapper ✅

entity/ (xj-admin)
  └── SystemConfig.java             # 系统配置实体 ✅

mapper/ (xj-admin)
  └── SystemConfigMapper.java       # 系统配置Mapper ✅
```

### 6.2 Banner管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/banner/list` | GET | Banner列表(分页) | ✅ |
| `/admin/banner/listAll` | GET | Banner列表(全部) | ✅ |
| `/admin/banner/{id}` | GET | Banner详情 | ✅ |
| `/admin/banner` | POST | 创建Banner | ✅ |
| `/admin/banner` | PUT | 更新Banner | ✅ |
| `/admin/banner/{id}/status` | PUT | 启用/禁用 | ✅ |
| `/admin/banner/{id}` | DELETE | 删除Banner | ✅ |
| `/admin/banner/sort` | PUT | 调整排序 | ✅ |

### 6.3 分类管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/category/list` | GET | 分类列表 | ✅ |
| `/admin/category/{id}` | GET | 分类详情 | ✅ |
| `/admin/category` | POST | 创建分类 | ✅ |
| `/admin/category` | PUT | 更新分类 | ✅ |
| `/admin/category/{id}/status` | PUT | 启用/禁用 | ✅ |
| `/admin/category/{id}` | DELETE | 删除分类 | ✅ |
| `/admin/category/sort` | PUT | 调整排序 | ✅ |

### 6.4 供应商管理接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/supplier/list` | GET | 供应商列表 | ✅ |
| `/admin/supplier/{id}` | GET | 供应商详情 | ✅ |
| `/admin/supplier` | POST | 创建供应商 | ✅ |
| `/admin/supplier` | PUT | 更新供应商 | ✅ |
| `/admin/supplier/{id}/status` | PUT | 启用/禁用 | ✅ |
| `/admin/supplier/{id}/resetPassword` | POST | 重置密码 | ✅ |
| `/admin/supplier/{id}` | DELETE | 删除供应商 | ✅ |

### 6.5 系统配置接口
| 接口 | 方法 | 说明 | 状态 |
|------|------|------|------|
| `/admin/config/list` | GET | 配置列表 | ✅ |
| `/admin/config/map` | GET | 配置Map | ✅ |
| `/admin/config/value` | GET | 获取配置值 | ✅ |
| `/admin/config` | PUT | 更新配置 | ✅ |
| `/admin/config/batch` | PUT | 批量更新配置 | ✅ |
| `/admin/config` | DELETE | 删除配置 | ✅ |

### 6.6 业务逻辑
- [x] Banner支持跳转类型（无跳转/线路详情/外部链接/小程序页面）
- [x] Banner支持展示时间段控制
- [x] 分类支持按业务类型筛选
- [x] 分类名称唯一性校验
- [x] 供应商账号创建与密码加密
- [x] 供应商密码重置并返回新密码
- [x] 供应商关联线路/订单统计
- [x] 系统配置键值对管理
- [x] 配置支持多种类型(string/number/json/boolean)

---

## Phase 7：数据统计 ⏳ 待开发

### 7.1 需要创建的文件
```
controller/
  └── DashboardController.java      # 数据看板接口
  
dto/
  └── DashboardVO.java
  └── SalesStatsVO.java
  └── UserStatsVO.java
  
service/
  └── DashboardService.java
```

### 7.2 数据看板接口
| 接口 | 方法 | 说明 | 权限 |
|------|------|------|------|
| `/admin/dashboard/overview` | GET | 总览数据 | 管理员/供应商 |
| `/admin/dashboard/sales` | GET | 销售统计 | 管理员/供应商 |
| `/admin/dashboard/orders` | GET | 订单统计 | 管理员/供应商 |
| `/admin/dashboard/users` | GET | 用户统计 | 管理员 |
| `/admin/dashboard/routes` | GET | 线路排行 | 管理员/供应商 |

### 7.3 统计指标
- [ ] 今日/本周/本月订单数
- [ ] 今日/本周/本月销售额
- [ ] 待处理订单数
- [ ] 待审核退款数
- [ ] 新增用户数
- [ ] 新增会员数
- [ ] 线路销量排行
- [ ] 销售趋势图

---

## 技术要点

### 权限控制
```java
// 管理员专属接口
@SaCheckRole("admin")

// 供应商数据隔离
Long supplierId = StpUtil.getSession().get("supplierId");
if (supplierId != null) {
    // 只查询该供应商的数据
    wrapper.eq(Route::getSupplierId, supplierId);
}
```

### 分页查询
```java
@GetMapping("/list")
public Result<PageResult<RouteListVO>> list(RouteQueryRequest request) {
    return Result.success(adminRouteService.pageList(request));
}
```

### Excel导出
```java
// 使用 EasyExcel
@GetMapping("/export")
public void export(HttpServletResponse response, OrderQueryRequest request) {
    List<OrderExportVO> data = orderService.listForExport(request);
    EasyExcel.write(response.getOutputStream(), OrderExportVO.class)
        .sheet("订单列表")
        .doWrite(data);
}
```

---

## 开发顺序建议

1. **Phase 2 线路管理** - 核心业务，供应商入驻后首先需要
2. **Phase 3 订单管理** - 有订单后需要处理
3. **Phase 6 供应商管理** - 配合线路管理使用
4. **Phase 4 用户管理** - 运营需要
5. **Phase 5 推广管理** - 营销需要
6. **Phase 7 数据统计** - 最后完善

---

## 测试账号

| 角色 | 账号 | 密码 |
|------|------|------|
| 超级管理员 | admin | admin123 |
| 供应商 | 待创建 | - |

---

## 相关文档

- [需求文档](/需求文档/寻迹千行需求方案_V4.md)
- [技术方案](/技术方案/寻迹千行技术方案_V1.md)
- [数据库设计](/xunjiqianxing/docs/sql/init.sql)
- [API测试](/xunjiqianxing/xj-admin/http/admin-api-test.http)
