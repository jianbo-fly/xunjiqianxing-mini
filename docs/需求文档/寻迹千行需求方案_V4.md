# 寻迹千行 产品需求方案文档（PRD）

**版本：V4.1 | 日期：2026年2月**

---

# 第一部分：项目概述

## 1.1 产品定位

**寻迹千行**是一个综合旅游服务平台，一期聚焦「旅行」业务，后续扩展租车、民宿、门票、美食等模块。

平台包含：
- **C端用户小程序**：浏览线路、定制游、下单支付、会员、领队
- **B端管理后台**：线路管理、订单管理、定制管理、会员/领队/推广管理

## 1.2 核心业务流程

**跟团游流程**
```
用户浏览线路 → 选择套餐/日期 → 下单支付 → 商家确认 → 出行 → 订单完成
```

**定制游流程**
```
用户提交定制需求 → 企微通知客服 → 客服联系用户 → 沟通方案 → 确认下单
```

**推广流程**
```
推广员生成专属码 → 用户扫码绑定 → 用户下单完成 → 推广员获积分
```

## 1.3 角色定义

| 角色 | 说明 | 使用端 |
|------|------|--------|
| 普通用户 | C端消费者 | 小程序 |
| 会员 | 付费用户，享专属权益 | 小程序 |
| 领队 | 付费认证，可发布行程、带队赚佣金 | 小程序 |
| 推广员 | 推广引流赚积分 | 小程序 |
| 供应商 | 旅行社，发布线路、处理订单 | PC管理后台 |
| 管理员 | 平台运营人员 | PC管理后台 |

## 1.4 版本范围

### P0 必做

| 模块 | 功能 |
|------|------|
| 首页 | Logo+积分+消息入口、功能入口、轮播图、热门线路、在线客服 |
| 旅游 | 搜索页、跟团游列表、线路详情、套餐选择、日期选择、人数选择、下单支付 |
| 定制游 | 卡片选择式表单、提交成功页、我的定制列表页、定制需求详情页、企微通知、后台管理 |
| 行程 | 待出行订单、推荐线路 |
| 订单 | 订单列表、订单详情、支付结果页（成功/失败）、取消订单 |
| 会员 | 开通会员、会员信息页（正常/即将到期/已过期）、会员权益展示 |
| 领队 | 领队申请、审核、发布行程、被预约 |
| 推广 | 生成推广码、推广数据、积分记录 |
| 我的 | 用户信息、订单入口、积分、优惠券、设置、关于我们 |
| B端后台 | 线路管理、订单管理、定制管理、会员/领队/推广管理 |

### P1 应做

| 模块 | 功能 |
|------|------|
| 退款 | 退款申请、退款审核 |
| 优惠券 | 优惠券发放、使用 |
| 常用出行人 | 出行人管理 |
| 消息通知 | 消息中心、订单消息（支付/确认/拒单/退款）、出行提醒、微信订阅消息推送 |

### P2 可做

| 模块 | 功能 |
|------|------|
| 找搭子 | 社交功能 |
| 租车/民宿/门票等 | 综合服务扩展 |
| 加盟合作 | 商家入驻 |

### 本期不做

| 功能 | 说明 |
|------|------|
| 找搭子 | TabBar占位，显示「敬请期待」 |
| 租车/民宿/门票等 | 首页入口占位，点击提示「即将上线」 |
| IM消息系统 | 用企业微信客服替代 |
| 发票 | 后续版本 |
| 评价/收藏 | 后续版本 |

---

# 第二部分：C端小程序功能

## 2.1 TabBar结构

| Tab | 页面 | 说明 |
|-----|------|------|
| 首页 | 首页 | 功能入口、推荐内容 |
| 搭子 | 占位页 | 显示「敬请期待」 |
| 行程 | 行程页 | 待出行订单、推荐线路 |
| 我的 | 个人中心 | 用户信息、功能入口汇总 |

---

## 2.2 首页

### 页面结构

| 模块 | 功能 |
|------|------|
| 顶部栏 | Logo图标、积分显示、消息入口（图标+未读红点，点击进入消息中心） |
| 轮播图 | 广告展示，后台配置 |
| 功能入口 | 8个入口：旅游/定制（可用）、租车/民宿/门票/接送/美食/租赁/保险（占位） |
| 热门线路 | 推荐线路卡片，点击进入线路详情 |
| 在线客服 | 悬浮按钮，点击跳转企业微信客服 |

### 功能入口说明

| 入口 | 状态 | 点击行为 |
|------|------|---------|
| 旅游/定制 | 可用 | 跳转旅游页 |
| 租车自驾 | 占位 | Toast「即将上线」 |
| 店/民宿 | 占位 | Toast「即将上线」 |
| 景点门票 | 占位 | Toast「即将上线」 |
| 接送机/包车 | 占位 | Toast「即将上线」 |
| 美食玩乐 | 占位 | Toast「即将上线」 |
| 租赁服务 | 占位 | Toast「即将上线」 |
| 旅游保险 | 占位 | Toast「即将上线」 |

### 线路卡片展示

| 字段 | 说明 |
|------|------|
| 封面图 | 线路主图 |
| 线路名称 | 如「云南大理丽江6日游」 |
| 价格 | 显示「¥XXX起」，取最低套餐价格 |
| 销量/评分 | 如「已售1280」「⭐4.8」 |

---

## 2.3 搭子页（占位）

| 内容 | 说明 |
|------|------|
| 页面状态 | 占位页 |
| 展示内容 | 图标 + 「敬请期待」 + 「更多精彩功能即将上线」 |

---

## 2.4 行程页

### 页面结构

| 模块 | 功能 |
|------|------|
| 待出行 | 展示状态为「已确认」且出发日期未到的订单 |
| 推荐线路 | 线路推荐卡片 |

### 待出行卡片

| 字段 | 说明 |
|------|------|
| 线路名称 | 如「云南大理丽江6日游」 |
| 出发日期 | 如「01-20出发」 |
| 倒计时 | 如「还有3天」 |
| 套餐/人数 | 如「舒适型 · 2成人1儿童」 |
| 操作 | 「查看详情」→ 订单详情页 |

---

## 2.5 我的页面

### 页面结构

| 模块 | 内容 |
|------|------|
| 用户信息 | 头像、昵称、手机号、会员标识 |
| 我的订单 | 快捷入口：待支付/待确认/待出行/已完成，「全部」入口 |
| 我的资产 | 积分数量、优惠券数量 |
| 功能入口 | 开通会员、成为领队、推广中心、常用出行人、设置、联系客服、关于我们 |

### 功能入口

| 入口 | 跳转页面 | 优先级 |
|------|---------|--------|
| 开通会员 | 会员开通页 | P0 |
| 成为领队 | 领队申请页 | P0 |
| 推广中心 | 推广中心页 | P0 |
| 常用出行人 | 出行人管理页 | P1 |
| 积分 | 积分明细页 | P0 |
| 优惠券 | 优惠券列表页 | P1 |
| 联系客服 | 企业微信客服 | P0 |
| 设置 | 设置页 | P0 |
| 关于我们 | 关于页面 | P0 |

---

## 2.6 旅游页

### 入口

从首页「旅游/定制」功能入口跳转，非TabBar页面，左上角有返回按钮。

### 页面结构

| 模块 | 功能 |
|------|------|
| 顶部导航 | 返回按钮、搜索图标 |
| 顶部Tab | 「跟团游」「定制游」切换 |
| 内容区 | 根据Tab显示对应内容 |

---

### 2.6.1 搜索页

**入口**：旅游页顶部🔍搜索图标

| 模块 | 功能 |
|------|------|
| 搜索框 | 输入关键词搜索目的地或线路名称，支持清空 |
| 热门搜索 | 后台配置的热门关键词标签，点击直接搜索 |
| 搜索历史 | 本地保存最近搜索记录，支持一键清空 |
| 搜索结果 | 线路卡片列表，与跟团游列表卡片样式一致 |
| 无结果 | 显示空状态插图 + 引导文案「换个关键词试试吧」 |

**交互规则**

| 操作 | 行为 |
|------|------|
| 点击热门/历史标签 | 直接执行搜索 |
| 输入后点击搜索 | 搜索并保存到历史记录 |
| 点击清空 | 清空搜索历史（二次确认） |
| 点击取消 | 返回旅游页 |

---

### 2.6.2 跟团游Tab

| 模块 | 功能 |
|------|------|
| 二级分类 | 「国内游」「出境游」切换 |
| 筛选 | 出发地、天数、价格区间 |
| 线路列表 | 线路卡片列表，下拉加载更多 |

### 线路卡片

| 字段 | 说明 |
|------|------|
| 封面图 | 线路主图 |
| 线路名称 | 如「云南大理丽江6日游」 |
| 标签 | 如「纯玩」「品质」 |
| 评分/销量 | 如「⭐4.8 | 已售1280」 |
| 价格 | 「¥XXX起」 |

---

### 2.6.3 定制游Tab

**交互方式**：卡片选择式，点选为主，减少输入

| 字段 | 交互方式 | 选项 |
|------|---------|------|
| 目的地 | 热门卡片+「其他」输入 | 云南、三亚、日本、新疆、西藏、其他 |
| 出行时间 | 快捷选项+日期选择器 | 本周末、下周、本月、选日期 |
| 出行天数 | 单选按钮 | 3-5天、6-8天、9天+、不确定 |
| 出行人数 | 加减器 | 成人数、儿童数 |
| 预算范围 | 单选按钮 | 3k以下、3-5k、5-8k、8k-1w、1w+ |
| 其他需求 | 多选标签+补充输入 | 有老人、有小孩、蜜月、不购物、轻松不赶、深度体验、网红打卡 |
| 联系方式 | 默认读取手机号 | - |

### 提交成功页

| 内容 | 说明 |
|------|------|
| 成功提示 | 「✅ 提交成功！」 |
| 说明文案 | 「专属旅行顾问将在30分钟内联系您」 |
| 操作按钮 | 「返回首页」「查看我的定制」 |

### 我的定制列表页

**入口**：定制游提交成功页 → 查看我的定制；我的页面 → 我的定制

| 模块 | 功能 |
|------|------|
| 状态Tab | 全部、待处理、跟进中、已完成 |
| 定制卡片 | 目的地、出行时间、天数、人数、预算、提交时间、状态 |
| 操作按钮 | 待处理可取消需求，所有状态可查看详情 |
| 空状态 | 显示插图 + 「暂无定制需求」 + 「去定制旅行」按钮 |

**定制需求状态**

| 状态 | 说明 | 用户可操作 |
|------|------|-----------|
| 待处理 | 已提交，等待客服联系 | 取消需求、查看详情 |
| 跟进中 | 客服已联系，沟通中 | 查看详情 |
| 已完成 | 已成交或已确认方案 | 查看详情 |
| 已关闭 | 用户取消或无法满足 | 查看详情 |

### 定制需求详情页

**入口**：我的定制列表 → 查看详情

| 模块 | 内容 |
|------|------|
| 状态显示 | 当前状态 + 状态说明文案 |
| 定制信息 | 目的地、出行时间、天数、人数、预算、其他需求、补充说明 |
| 联系方式 | 用户手机号（脱敏显示） |
| 需求编号 | 定制需求唯一编号 |
| 提交时间 | 用户提交时间 |
| 操作按钮 | 待处理状态显示「取消需求」「联系客服」；其他状态显示「联系客服」 |

---

## 2.7 线路详情页

### 页面结构

| 模块 | 内容 |
|------|------|
| 轮播图 | 线路图片展示 |
| 基础信息 | 线路名称、价格（¥XXX起）、出发地、行程天数 |
| 套餐选择 | 套餐列表，展示名称、标签、资源配置、价格 |
| 日期选择 | 日历形式，显示每日价格 |
| 人数选择 | 成人/儿童人数加减器，实时显示合计金额 |
| Tab内容 | 行程介绍、费用说明、预订须知 |
| 商家信息 | 商家名称、Logo、电话 |
| 底部操作栏 | 「客服」按钮、「立即预订」按钮 |

### 套餐卡片展示

| 字段 | 说明 |
|------|------|
| 套餐名称 | 如「经济型」「舒适型」「尊享型」 |
| 套餐标签 | 如「热销」「纯玩」 |
| 资源配置 | 🏨住宿 🍽️餐饮 🛍️购物 👥团型（图标+关键词） |
| 价格 | 该套餐基准价 |

### 日期选择

| 状态 | 显示 | 说明 |
|------|------|------|
| 可选 | 显示价格（如¥3999） | 有库存，可点击 |
| 选中 | 价格高亮+底色 | 当前选中 |
| 售罄 | 显示「售罄」灰色 | 库存为0，不可点击 |
| 过期 | 灰色 | 已过日期，不可选 |
| 未配置 | 不显示或「-」 | 该日期未配置价格 |

### 人数选择

| 元素 | 默认值 | 范围 | 说明 |
|------|--------|------|------|
| 成人数量 | 1 | 1 ~ 库存上限 | 至少1人 |
| 儿童数量 | 0 | 0 ~ 成人数量 | 儿童数不能超过成人数 |
| 合计金额 | - | - | 实时计算：成人价×成人数 + 儿童价×儿童数 |

**交互逻辑**
- 选择日期后，根据当日价格日历显示成人价和儿童价
- 调整人数时实时更新合计金额
- 总人数不能超过当日剩余库存，超出时提示「库存不足」
- 点击「立即预订」时校验：已选套餐、已选日期、成人数≥1

### 行程介绍Tab

展示每天的行程安排：

| 内容 | 说明 |
|------|------|
| 日程标题 | 如「Day 1 北京 → 昆明」 |
| 行程内容 | 当天活动安排（交通、景点、用餐等） |
| 含餐说明 | 当天包含的餐食 |
| 住宿说明 | 当晚入住酒店 |

配置级别：**套餐级别**（不同套餐行程可能不同）

### 费用说明Tab

| 内容 | 说明 |
|------|------|
| 费用包含 | 交通、住宿、餐饮、门票、服务等（套餐级别配置） |
| 费用不含 | 自费项目、个人消费、单房差等（线路级别配置） |

### 预订须知Tab

| 内容 | 说明 | 配置级别 |
|------|------|---------|
| 退改规则 | 各时间段退款比例 | 平台级别 |
| 预订须知 | 起订人数、儿童价说明、证件要求等 | 线路级别 |
| 温馨提示 | 目的地注意事项、装备建议等 | 线路级别 |

---

## 2.8 确认订单页

### 页面结构

| 模块 | 内容 |
|------|------|
| 订单信息 | 线路名称、套餐、出发日期、成人/儿童价格明细 |
| 出行人信息 | 添加出行人（姓名、身份证、手机号、类型） |
| 联系人信息 | 默认使用用户信息，可切换其他联系人 |
| 优惠券 | 选择可用优惠券（P1） |
| 退改规则 | 退款规则说明 |
| 金额合计 | 总金额 = 成人数×成人价 + 儿童数×儿童价 - 优惠 |
| 提交按钮 | 「提交订单」→ 调起微信支付 |

### 出行人信息

| 字段 | 必填 | 说明 |
|------|------|------|
| 姓名 | 是 | 真实姓名 |
| 证件类型 | 是 | 身份证/护照/港澳通行证/台湾通行证 |
| 证件号码 | 是 | 用于购买保险、景区实名，身份证需验证格式（15/18位） |
| 手机号 | 是 | 紧急联系 |
| 类型 | 是 | 成人/儿童（12岁以下） |

**出行人添加方式**
- 手动添加：填写出行人信息
- 从常用出行人选择：选择已保存的出行人信息自动填充

---

## 2.9 支付结果页

**入口**：微信支付完成后自动跳转

### 支付成功

| 内容 | 说明 |
|------|------|
| 状态标识 | 成功图标 + 「支付成功」 |
| 金额 | 显示实付金额 |
| 订单摘要 | 线路名称、套餐、出发日期、人数 |
| 提示信息 | 「订单已提交，等待商家确认，确认后将通过消息通知您」 |
| 操作按钮 | 「返回首页」→ 首页、「查看订单」→ 订单详情页 |

### 支付失败

| 内容 | 说明 |
|------|------|
| 状态标识 | 失败图标 + 「支付失败」 |
| 提示信息 | 「请检查支付方式后重试」 |
| 订单摘要 | 线路名称、套餐、出发日期、待支付金额 |
| 操作按钮 | 「返回首页」→ 首页、「重新支付」→ 重新调起微信支付 |

---

## 2.10 订单管理

### 订单列表页

| 模块 | 功能 |
|------|------|
| 状态Tab | 全部、待支付、待确认、待出行、已完成 |
| 订单卡片 | 线路名称、套餐、日期、人数、金额、状态、操作按钮 |

### 订单状态

| 状态 | 说明 | 用户可操作 |
|------|------|-----------|
| 待支付 | 订单已创建，30分钟内需支付 | 去支付、取消订单 |
| 待确认 | 已支付，等待商家确认 | 申请退款 |
| 已确认 | 商家已确认，等待出行 | 申请退款 |
| 已完成 | 行程结束 | - |
| 已取消 | 用户取消或超时未支付 | - |
| 退款中 | 已申请退款，等待审核 | - |
| 已退款 | 退款完成 | - |
| 已拒绝 | 商家拒绝接单，已自动退款 | - |

### 订单详情页

| 模块 | 内容 |
|------|------|
| 订单状态 | 当前状态及说明 |
| 线路信息 | 线路名称、套餐、出发日期、天数 |
| 出行人列表 | 所有出行人信息 |
| 联系人信息 | 联系人姓名、电话 |
| 金额明细 | 成人费用、儿童费用、优惠、实付金额 |
| 商家信息 | 商家名称、电话 |
| 订单信息 | 订单编号、创建时间、支付时间 |
| 操作按钮 | 根据状态显示（取消、支付、申请退款等） |

---

## 2.11 退款申请（P1）

### 申请条件

- 订单状态为「待确认」或「已确认」
- 出发日期之前

### 退款规则

| 申请时间 | 退款比例 |
|---------|---------|
| 出发前7天（含）以上 | 100% |
| 出发前3-6天 | 70% |
| 出发前1-2天 | 50% |
| 出发当天 | 不可退款 |

### 退款流程

```
用户申请退款 → 填写退款原因 → 提交 → 商家审核 → 审核通过 → 原路退回
```

---

## 2.12 会员

### 会员开通页

| 内容 | 说明 |
|------|------|
| 会员价格 | ¥99/年 |
| 会员权益 | 专属客服、免费改期、专属线路、优惠券礼包 |
| 开通按钮 | 「立即开通 ¥99」→ 微信支付 |

### 会员权益说明

| 权益 | 说明 |
|------|------|
| 专属客服 | 一对一VIP客服服务 |
| 免费改期 | 行程变动可免费改期（具体规则待定义） |
| 专属线路 | 会员专享优质线路 |
| 优惠券礼包 | 开通即送优惠券（具体规则待定义） |

### 会员信息页

**入口**：我的 → 开通会员（已开通时跳转此页）

| 内容 | 说明 |
|------|------|
| 会员标识 | 会员图标 + 用户昵称 |
| 有效期 | 有效期至 YYYY-MM-DD，剩余 X 天 |
| 我的权益 | 各项权益使用状态（可用/已领/已失效） |
| 会员记录 | 开通时间、到期时间、支付金额 |
| 操作按钮 | 「续费会员」→ 微信支付 |

**会员状态**

| 状态 | 显示 | 操作 |
|------|------|------|
| 正常 | 绿色有效期 + 剩余天数，权益显示「可用」 | 续费会员 |
| 即将到期（7天内） | 顶部警告横幅「您的会员将于X天后到期」 | 续费按钮突出 |
| 已过期 | 灰色图标 + 「会员已过期」，权益显示「已失效」 | 「立即续费，恢复权益」 |

**入口逻辑**

| 会员状态 | 我的页面显示 | 点击跳转 |
|---------|-------------|---------|
| 未开通 | 「开通会员」 | 会员开通页 |
| 已开通 | 「我的会员」+ 👑 | 会员信息页 |
| 已过期 | 「续费会员」 | 会员信息页（过期状态） |

---

## 2.13 领队

### 领队申请页

| 内容 | 说明 |
|------|------|
| 领队价格 | ¥2000 |
| 领队特权 | 发布带队行程、接受用户预约、获得带队佣金 |
| 申请表单 | 真实姓名、手机号、擅长领域、个人简介、相关资质 |
| 审核说明 | 「提交后需审核，审核通过后扣款」 |
| 提交按钮 | 「提交申请」 |

### 领队特权说明

| 特权 | 说明 |
|------|------|
| 发布带队行程 | 发布自己的行程，招募队员 |
| 接受用户预约 | 用户可预约领队带队出行 |
| 获得带队佣金 | 带队成功获得佣金（具体比例待定义） |

### 领队审核状态

| 状态 | 说明 |
|------|------|
| 待审核 | 已提交，等待平台审核 |
| 已通过 | 审核通过，扣款成功，成为领队 |
| 已拒绝 | 审核拒绝，显示拒绝原因，可重新申请 |

---

## 2.14 推广中心

### 入口

「我的」页面 → 「推广中心」

### 页面结构

| 模块 | 内容 |
|------|------|
| 店铺信息 | 头像、名称、地址 |
| 推广数据 | 扫码人数、订单数、积分 |
| 推广码 | 专属小程序码，可保存、分享 |
| 功能入口 | 编辑店铺信息 |

### 首次进入

如未申请过推广员，显示申请入口，填写店铺信息提交申请。

### 积分获取规则

| 来源 | 规则 |
|------|------|
| 下单消费 | 用户下单获得积分（具体规则待定义） |
| 推广成交 | 推广用户下单完成，推广员获得积分（具体规则待定义） |

---

## 2.15 积分

### 积分明细页

| 模块 | 内容 |
|------|------|
| 积分余额 | 当前可用积分 |
| 积分明细 | 积分获取/使用记录列表 |

### 积分记录

| 字段 | 说明 |
|------|------|
| 类型 | 获取/使用 |
| 来源 | 如「下单奖励」「推广奖励」 |
| 积分数 | +100 / -50 |
| 时间 | 记录时间 |
| 关联订单 | 关联的订单编号（如有） |

---

## 2.16 优惠券（P1）

### 优惠券列表页

| 模块 | 内容 |
|------|------|
| 状态Tab | 未使用、已使用、已过期 |
| 优惠券卡片 | 面额、使用条件、有效期、状态 |

### 优惠券卡片

| 字段 | 说明 |
|------|------|
| 面额 | 如「¥100」 |
| 类型 | 如「满减券」「折扣券」 |
| 使用条件 | 如「满1000可用」 |
| 适用范围 | 如「全场通用」「指定线路」 |
| 有效期 | 如「2026.01.01-2026.03.31」 |

---

## 2.17 常用出行人（P1）

### 出行人列表页

| 功能 | 说明 |
|------|------|
| 列表展示 | 已保存的出行人信息 |
| 添加 | 新增出行人 |
| 编辑 | 修改出行人信息 |
| 删除 | 删除出行人 |
| 设为默认 | 设置默认出行人 |

### 出行人信息

| 字段 | 必填 | 说明 |
|------|------|------|
| 姓名 | 是 | 真实姓名 |
| 证件类型 | 是 | 身份证/护照/港澳通行证/台湾通行证 |
| 证件号码 | 是 | 加密存储，身份证需验证格式（15/18位） |
| 手机号 | 是 | 联系电话 |
| 是否默认 | 否 | 下单时默认选中，自动填充出行人信息 |

**表单验证规则**

| 字段 | 验证规则 |
|------|---------|
| 姓名 | 不能为空 |
| 证件号码 | 身份证15/18位格式校验；护照等按证件类型校验 |
| 手机号 | 11位手机号格式 |

**入口来源**
- 我的 → 常用出行人
- 确认订单页 → 从常用出行人选择 → 新增出行人

---

## 2.18 用户登录

### 登录流程

```
打开小程序 → 微信授权（获取头像昵称）→ 手机号授权（必填）→ 登录成功
```

### 登录方式

| 方式 | 说明 |
|------|------|
| 微信授权登录 | 获取微信头像、昵称、openid |
| 手机号绑定 | 必填，支持微信手机号快捷获取 |

---

## 2.19 关于我们页

**入口**：我的 → 关于我们

### 页面结构

| 模块 | 内容 |
|------|------|
| 品牌信息 | Logo + 产品名「寻迹千行」+ 版本号 |
| 简介 | 平台定位介绍文案 |
| 联系方式 | 客服电话（点击拨号）、在线客服（跳转企业微信）、商务合作邮箱（点击复制） |
| 协议入口 | 用户协议（WebView）、隐私政策（WebView） |
| 版权信息 | 底部显示版权声明 |

### 交互规则

| 操作 | 行为 |
|------|------|
| 点击客服电话 | 调起系统拨号界面 |
| 点击在线客服 | 跳转企业微信客服 |
| 点击商务合作 | 复制邮箱到剪贴板，Toast「已复制」 |
| 点击用户协议 | 跳转 WebView 页面 |
| 点击隐私政策 | 跳转 WebView 页面 |

---

## 2.20 消息通知

### 页面展示设计

#### 首页消息入口

```
┌─────────────────────────────────┐
│  Logo        🔔 积分:1280      │  ← 消息图标 + 红点(未读数)
└─────────────────────────────────┘
```

| 元素 | 说明 |
|------|------|
| 位置 | 首页顶部栏右侧 |
| 展示 | 消息图标 + 未读数量红点（超过99显示99+） |
| 交互 | 点击进入消息中心页面 |

#### 消息列表页

```
┌─────────────────────────────────┐
│  ←  消息中心            全部已读 │
├─────────────────────────────────┤
│  全部 | 订单通知 | 系统消息      │  ← Tab分类
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ 🛒 订单确认通知        10:30 │ │
│ │ 您的订单已被商家确认，请准备  │ │
│ │ 出行。订单号：2026012100001  │ │
│ │                      ● 未读 │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ ✈️ 出行提醒           昨天   │ │
│ │ 您预订的「云南6日游」明天出发 │ │
│ │ 请做好出行准备！             │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 💰 退款成功           01-18 │ │
│ │ 您的退款申请已通过，¥2980已  │ │
│ │ 原路退回，请注意查收         │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

#### 消息卡片设计

| 元素 | 说明 |
|------|------|
| 图标 | 根据消息类型显示不同图标（订单🛒/出行✈️/退款💰/系统📢） |
| 标题 | 消息标题，最多显示一行 |
| 内容 | 消息摘要，最多显示两行 |
| 时间 | 今天显示时分，昨天显示"昨天"，更早显示日期 |
| 未读标识 | 未读消息显示蓝色圆点 |
| 点击交互 | 标记已读 + 跳转相关页面 |

---

### 消息业务类型

#### 订单相关消息（P0）

| 消息类型 | 触发时机 | 消息标题 | 消息内容模板 | 跳转目标 |
|---------|---------|---------|-------------|---------|
| 支付成功 | 用户支付完成 | 订单支付成功 | 您已成功支付订单，订单号：{orderNo}，金额：¥{amount}，线路：{routeName} | 订单详情页 |
| 商家确认 | 商家点击确认接单 | 订单已确认 | 您的订单已被商家确认，{routeName}将于{departDate}出发，请做好出行准备 | 订单详情页 |
| 商家拒单 | 商家拒绝接单 | 订单未通过 | 很抱歉，商家无法接受您的订单，原因：{reason}，款项将在1-3个工作日内原路退回 | 订单详情页 |
| 出行提醒 | 出发前1天（定时任务） | 出行提醒 | 您预订的「{routeName}」明天出发，请准时到达集合地点：{meetingPoint} | 订单详情页 |
| 退款申请 | 用户提交退款申请 | 退款申请已提交 | 您的退款申请已提交，预计退款金额：¥{refundAmount}，请等待商家审核 | 订单详情页 |
| 退款成功 | 退款审核通过 | 退款成功 | 您的退款申请已通过，¥{refundAmount}已原路退回，请注意查收 | 订单详情页 |
| 退款驳回 | 退款审核驳回 | 退款被驳回 | 您的退款申请被驳回，原因：{reason}，如有疑问请联系客服 | 订单详情页 |

#### 系统消息（P2）

| 消息类型 | 触发时机 | 消息标题 | 消息内容模板 | 跳转目标 |
|---------|---------|---------|-------------|---------|
| 会员即将到期 | 到期前7天 | 会员即将到期 | 您的会员将于{expireDate}到期，续费可继续享受专属权益 | 会员页 |
| 会员已到期 | 到期当天 | 会员已到期 | 您的会员已到期，立即续费继续享受专属客服、免费改期等权益 | 会员页 |
| 系统公告 | 后台发布 | {title} | {content} | 指定页面/无 |

---

### 技术实现方案

#### 数据库设计

```sql
-- 消息表
CREATE TABLE messages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '消息ID',
    user_id BIGINT NOT NULL COMMENT '接收用户ID',
    type VARCHAR(32) NOT NULL COMMENT '消息类型: order_paid/order_confirmed/order_rejected/trip_reminder/refund_apply/refund_success/refund_reject/member_expire/system',
    title VARCHAR(100) NOT NULL COMMENT '消息标题',
    content TEXT COMMENT '消息内容',
    biz_id VARCHAR(64) COMMENT '关联业务ID(如订单号)',
    biz_type VARCHAR(32) COMMENT '业务类型: order/refund/member',
    jump_url VARCHAR(255) COMMENT '跳转路径',
    is_read TINYINT DEFAULT 0 COMMENT '是否已读: 0未读 1已读',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_user_read (user_id, is_read),
    INDEX idx_user_created (user_id, created_at DESC)
) COMMENT '用户消息表';
```

#### 后端接口设计

| 接口 | 方法 | 参数 | 返回 | 说明 |
|-----|------|-----|------|-----|
| `/api/messages` | GET | page, pageSize, type | 消息列表+分页信息 | 获取消息列表，支持按类型筛选 |
| `/api/messages/unread-count` | GET | - | {count: number} | 获取未读消息数量（首页红点用） |
| `/api/messages/{id}/read` | POST | - | success | 标记单条消息已读 |
| `/api/messages/read-all` | POST | type(可选) | success | 全部标记已读，可按类型 |

#### 消息触发机制

```
业务事件触发流程：
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  业务事件    │ ──▶ │  消息服务    │ ──▶ │  存入数据库  │
│ (支付/确认)  │     │  生成消息    │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ 小程序订阅消息│  ← 可选：微信主动推送
                    └─────────────┘

定时任务触发流程（出行提醒）：
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  每日定时任务 │ ──▶ │ 查询明天出发  │ ──▶ │ 批量生成消息 │
│  (如每天8:00) │     │  的订单      │     │ + 推送通知   │
└─────────────┘     └─────────────┘     └─────────────┘
```

---

### 微信订阅消息模板

需在微信公众平台申请订阅消息模板：

| 模板名称 | 模板字段 | 使用场景 |
|---------|---------|---------|
| 订单支付成功通知 | 订单号、支付金额、商品名称、支付时间 | 用户支付成功后推送 |
| 订单状态变更通知 | 订单号、订单状态、变更时间、备注 | 商家确认/拒单时推送 |
| 出行提醒通知 | 行程名称、出发日期、集合地点、温馨提示 | 出发前1天推送 |
| 退款结果通知 | 退款金额、退款状态、退款时间、原订单号 | 退款成功/驳回时推送 |

**小程序端订阅时机**：
- 用户下单支付前，引导订阅「订单支付成功」「订单状态变更」「出行提醒」
- 用户申请退款时，引导订阅「退款结果通知」

---

### 消息功能开发排期

#### Phase 1：核心消息功能（P0）
- 消息数据表设计与接口开发
- 首页消息入口 + 未读红点
- 消息列表页（基础列表，无Tab分类）
- 支付成功消息、商家确认/拒单消息
- 消息点击跳转 + 标记已读

#### Phase 2：完善消息功能（P1）
- 消息列表Tab分类（全部/订单通知/系统消息）
- 一键全部已读
- 出行提醒（定时任务）
- 退款相关消息
- 微信订阅消息推送接入

#### Phase 3：扩展消息功能（P2）
- 会员到期提醒
- 系统公告功能
- 后台消息管理（管理员发布系统公告）

---

# 第三部分：B端管理后台功能

## 3.1 登录

| 功能 | 说明 |
|------|------|
| 账号登录 | 账号+密码 |
| 角色区分 | 管理员进后台首页，供应商进商家后台 |

---

## 3.2 线路管理（供应商）

### 线路列表

| 功能 | 说明 |
|------|------|
| 列表展示 | 我发布的所有线路 |
| 状态筛选 | 全部/审核中/已通过/已驳回/已上架/已下架 |
| 操作 | 编辑、上架、下架、删除 |

### 发布/编辑线路

**基础信息**

| 字段 | 必填 | 说明 |
|------|------|------|
| 线路名称 | 是 | 如「云南大理丽江6日游」 |
| 封面图 | 是 | 列表展示用 |
| 轮播图 | 是 | 详情页展示，支持多张 |
| 分类 | 是 | 国内游/出境游 |
| 出发地 | 是 | 如「北京」 |
| 目的地 | 是 | 如「云南」 |
| 费用不含 | 是 | 富文本 |
| 预订须知 | 是 | 富文本 |
| 温馨提示 | 否 | 富文本 |

**套餐配置**

每条线路至少配置1个套餐：

| 分组 | 字段 | 必填 | 说明 |
|------|------|------|------|
| 基础 | 套餐名称 | 是 | 如「经济型」「舒适型」 |
| 基础 | 套餐标签 | 否 | 如「热销」「纯玩」 |
| 基础 | 行程天数 | 是 | 如「6」 |
| 基础 | 行程介绍 | 是 | 富文本，每日行程安排 |
| 基础 | 费用包含 | 是 | 富文本 |
| 住宿 | 住宿等级 | 是 | 三星/四星/五星/精品 |
| 住宿 | 住宿说明 | 否 | 酒店名称等 |
| 交通 | 交通等级 | 是 | 不限/优选时段/商务舱 |
| 交通 | 交通说明 | 否 | 航班时段等 |
| 用车 | 用车等级 | 是 | 大巴/中巴/商务车 |
| 用车 | 用车说明 | 否 | 座位数、车龄等 |
| 餐饮 | 含餐数量 | 是 | 如「5早3正」 |
| 餐饮 | 餐饮说明 | 否 | 餐标、特色餐等 |
| 门票 | 门票说明 | 是 | 包含哪些景点 |
| 门票 | 自费项目 | 否 | 不含的自费景点 |
| 购物 | 购物店数量 | 是 | 0=纯玩 |
| 购物 | 购物说明 | 否 | 停留时间等 |
| 团型 | 最大人数 | 是 | 成团上限 |
| 团型 | 团型标签 | 否 | 如「16人品质团」 |

**价格库存配置**

按套餐、按日期配置：

| 字段 | 说明 |
|------|------|
| 日期 | 可售卖日期 |
| 成人价 | 该日期的成人价格 |
| 儿童价 | 该日期的儿童价格 |
| 库存 | 该日期的库存数量 |

支持批量设置日期区间的价格和库存。

---

## 3.3 订单管理（供应商）

### 订单列表

| 功能 | 说明 |
|------|------|
| 列表展示 | 我的线路的所有订单 |
| 状态筛选 | 全部/待确认/已确认/退款中/已完成/已取消 |
| 搜索 | 订单号、用户手机号、线路名称 |
| 导出 | 导出Excel |

### 订单详情

| 内容 | 说明 |
|------|------|
| 订单基础信息 | 订单号、状态、创建时间等 |
| 线路信息 | 线路名称、套餐、出发日期 |
| 出行人列表 | 出行人信息（身份证脱敏显示） |
| 联系人信息 | 联系人姓名、电话 |
| 金额明细 | 成人费用、儿童费用、优惠、实付 |
| 操作记录 | 订单状态变更记录 |

### 订单操作

| 状态 | 可操作 |
|------|--------|
| 待确认 | 确认接单、拒绝接单（需填原因，自动退款） |
| 退款中 | 审核通过、审核驳回（需填原因） |

---

## 3.4 退款管理（供应商）

| 功能 | 说明 |
|------|------|
| 退款列表 | 我的线路的退款申请 |
| 状态筛选 | 待审核/已通过/已驳回 |
| 审核操作 | 通过/驳回（需填原因） |

---

## 3.5 定制需求管理

### 定制列表

| 功能 | 说明 |
|------|------|
| 列表展示 | 所有定制需求 |
| 状态筛选 | 待处理/跟进中/已完成/已关闭 |
| 搜索 | 用户手机号、目的地 |

### 定制详情

| 字段 | 说明 |
|------|------|
| 用户信息 | 手机号 |
| 目的地 | 用户选择的目的地 |
| 出行时间 | 开始日期-结束日期 |
| 出行天数 | 3-5天/6-8天/9天+/不确定 |
| 出行人数 | 成人数、儿童数 |
| 预算范围 | 预算区间 |
| 其他需求 | 标签+补充说明 |
| 提交时间 | 用户提交时间 |

### 定制操作

| 操作 | 说明 |
|------|------|
| 标记跟进中 | 开始处理 |
| 添加跟进记录 | 记录沟通内容 |
| 标记已完成 | 用户已下单或已成交 |
| 标记已关闭 | 用户放弃或无法满足 |

---

## 3.6 线路管理（管理员）

| 功能 | 说明 |
|------|------|
| 线路列表 | 全平台线路，按供应商/状态筛选 |
| 线路审核 | 通过/驳回（需填原因） |
| 线路详情 | 查看完整信息 |

---

## 3.7 订单管理（管理员）

| 功能 | 说明 |
|------|------|
| 订单列表 | 全平台订单 |
| 订单详情 | 查看完整信息 |
| 退款介入 | 可介入退款审核 |
| 导出 | 导出Excel |

---

## 3.8 供应商管理（管理员）

| 功能 | 说明 |
|------|------|
| 供应商列表 | 查看所有供应商 |
| 新增供应商 | 添加旅行社账号 |
| 编辑 | 修改供应商信息 |
| 启用/禁用 | 控制供应商账号状态 |

**供应商信息**

| 字段 | 必填 | 说明 |
|------|------|------|
| 商家名称 | 是 | 旅行社名称 |
| Logo | 否 | 用于C端展示 |
| 联系电话 | 是 | 用于C端展示 |
| 简介 | 否 | 商家介绍 |
| 资质证书 | 否 | 旅行社资质图片 |
| 登录账号 | 是 | 后台登录用 |
| 登录密码 | 是 | 后台登录用 |

---

## 3.9 会员管理（管理员）

| 功能 | 说明 |
|------|------|
| 会员列表 | 查看所有会员 |
| 会员详情 | 会员信息、开通时间、到期时间、订单记录 |
| 会员配置 | 会员价格、权益配置 |

---

## 3.10 领队管理（管理员）

| 功能 | 说明 |
|------|------|
| 领队列表 | 查看所有领队，按状态筛选 |
| 领队审核 | 通过/驳回（需填原因） |
| 领队详情 | 基本信息、带队记录、佣金记录 |
| 领队配置 | 领队价格、佣金比例配置 |

---

## 3.11 推广员管理（管理员）

| 功能 | 说明 |
|------|------|
| 推广员列表 | 查看所有推广员，按状态筛选 |
| 推广员审核 | 通过/驳回（需填原因） |
| 推广员详情 | 基本信息、推广业绩、积分记录 |
| 扫码记录 | 查看扫码绑定记录 |

---

## 3.12 内容管理（管理员）

### 轮播图管理

| 功能 | 说明 |
|------|------|
| 轮播图列表 | 查看所有轮播图 |
| 新增轮播图 | 上传图片，设置跳转（线路详情/无跳转） |
| 编辑 | 修改图片或跳转 |
| 排序 | 拖拽排序 |
| 启用/禁用 | 控制是否显示 |

### 分类管理

| 功能 | 说明 |
|------|------|
| 分类列表 | 查看所有分类 |
| 新增分类 | 填写名称、图标 |
| 编辑 | 修改名称、图标 |
| 排序 | 拖拽排序 |
| 启用/禁用 | 控制是否显示 |

---

## 3.13 系统设置（管理员）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 客服电话 | C端显示 | - |
| 企业微信客服链接 | 在线客服跳转地址 | - |
| 支付超时时间 | 分钟 | 30 |
| 积分规则 | 下单/推广积分比例 | 待配置 |
| 退款规则 | 各时间段退款比例 | 7天100%/3-6天70%/1-2天50% |
| 儿童年龄上限 | 周岁 | 12 |
| 会员价格 | 年费 | 99 |
| 领队价格 | 认证费 | 2000 |

---

# 第四部分：业务规则

## 4.1 订单状态流转

```
┌──────┐  支付成功  ┌──────┐  商家确认  ┌──────┐  出行结束  ┌──────┐
│待支付│ ────────> │待确认│ ────────> │已确认│ ────────> │已完成│
└──────┘           └──────┘           └──────┘           └──────┘
    │                  │                  │
    │ 超时/取消        │ 商家拒绝         │ 申请退款
    ▼                  ▼                  ▼
┌──────┐           ┌──────┐           ┌──────┐  审核通过  ┌──────┐
│已取消│           │已拒绝│           │退款中│ ────────> │已退款│
└──────┘           └──────┘           └──────┘           └──────┘
```

## 4.2 库存规则

| 规则 | 说明 |
|------|------|
| 扣减时机 | 创建订单时扣减 |
| 释放时机 | 取消/超时/拒绝/退款通过时释放 |
| 超卖 | 不允许，下单时检查库存 |
| 未配置日期 | 不可售卖 |

## 4.3 退款规则

| 申请时间 | 退款比例 |
|---------|---------|
| 出发前7天（含）以上 | 100% |
| 出发前3-6天 | 70% |
| 出发前1-2天 | 50% |
| 出发当天 | 不可退款 |

## 4.4 推广绑定规则

| 规则 | 说明 |
|------|------|
| 绑定条件 | 新用户（未绑定且未完成过订单） |
| 绑定方式 | 扫码静默绑定 |
| 不覆盖 | 已绑定用户扫新码不更换 |
| 解绑时机 | 首单完成后解绑 |
| 订单归属 | 下单时记录当前绑定的推广员 |

## 4.5 定制游通知规则

| 规则 | 说明 |
|------|------|
| 通知方式 | 企业微信消息通知 |
| 通知内容 | 用户信息、目的地、时间、人数、预算、需求 |
| 通知对象 | 配置的客服企微账号 |
| 响应要求 | 30分钟内联系用户 |

---

*— 文档结束 —*

**版本历史**

| 版本 | 日期 | 说明 |
|------|------|------|
| V1.0 | 2026-01 | 初稿 |
| V2.0 | 2026-01 | 补充套餐、推广员模块 |
| V3.0 | 2026-01 | 补充状态机、规则细节 |
| V3.1 | 2026-01 | 重新整合，业务需求为主 |
| V3.2 | 2026-01 | 套餐模块优化，六大资源项 |
| V3.3 | 2026-01 | 订单表结构优化 |
| V4.0 | 2026-01 | **全面改版**：产品定位调整为综合旅游平台；TabBar改为首页/搭子/行程/我的；新增定制游（卡片选择式）；新增会员体系（¥99/年）；新增领队体系（¥2000）；首页增加功能入口和在线客服；旅游页独立（顶部Tab切换跟团游/定制游）；行程页展示待出行订单；订单入口移至我的页面 |
| V4.1 | 2026-02 | **UI交互对齐补充**：新增搜索页（热门搜索+搜索历史）；新增支付结果页（成功/失败）；新增我的定制列表页和定制需求详情页；线路详情页增加人数选择和合计金额；出行人证件类型扩展（身份证/护照/港澳通行证/台湾通行证）；新增会员信息页多状态设计（正常/即将到期/已过期）；新增关于我们页详细设计 |
