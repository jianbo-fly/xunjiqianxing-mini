# 寻迹千行 - 微信小程序前端设计文档

> 版本：V1.0
> 更新日期：2026-01-25
> 设计目标：可配置化、组件化、易于后期UI美化

---

## 一、设计理念

### 1.1 核心原则

| 原则 | 说明 |
|-----|------|
| **样式与逻辑分离** | 业务逻辑和UI样式完全解耦，改样式不动JS |
| **Design Token驱动** | 所有视觉属性通过Token配置，一处修改全局生效 |
| **组件化开发** | 页面由可复用组件拼装，提高开发效率 |
| **配置优于硬编码** | 颜色、间距、功能开关等均通过配置文件管理 |

### 1.2 后期UI美化支持

本设计充分考虑"前期功能开发 + 后期UI美化"的场景：

- **前期开发**：专注功能实现，使用默认主题，样式简洁
- **后期美化**：UI设计师只需修改配置文件和资源文件，无需改动业务代码

```
UI改动影响范围：
├── config/design-tokens.js    → 修改颜色/字号/间距
├── assets/icons/              → 替换图标
├── assets/images/             → 替换图片
└── components/xxx/index.wxss  → 微调单个组件样式
```

---

## 二、项目结构

```
xj-miniprogram/
├── app.js                      # 小程序入口
├── app.json                    # 全局配置
├── app.wxss                    # 全局样式（CSS变量定义）
├── sitemap.json
│
├── config/                     # ★ 配置中心
│   ├── design-tokens.js        # 设计令牌（颜色/字号/间距等）
│   ├── theme.js                # 主题管理
│   ├── api.js                  # API接口配置
│   ├── app.config.js           # 应用功能配置
│   └── constants.js            # 常量定义
│
├── styles/                     # ★ 全局样式
│   ├── variables.wxss          # CSS变量（由design-tokens生成）
│   ├── reset.wxss              # 样式重置
│   ├── mixins.wxss             # 通用样式混入
│   └── animation.wxss          # 动画样式
│
├── components/                 # ★ 组件库
│   ├── base/                   # 基础组件
│   │   ├── xj-button/
│   │   ├── xj-input/
│   │   ├── xj-card/
│   │   ├── xj-tag/
│   │   ├── xj-icon/
│   │   ├── xj-image/
│   │   ├── xj-empty/
│   │   ├── xj-loading/
│   │   ├── xj-modal/
│   │   ├── xj-toast/
│   │   └── xj-popup/
│   │
│   ├── business/               # 业务组件
│   │   ├── route-card/         # 线路卡片
│   │   ├── order-card/         # 订单卡片
│   │   ├── traveler-form/      # 出行人表单
│   │   ├── price-calendar/     # 价格日历
│   │   ├── date-picker/        # 日期选择器
│   │   ├── pay-panel/          # 支付面板
│   │   └── review-item/        # 评价项
│   │
│   └── layout/                 # 布局组件
│       ├── nav-bar/            # 自定义导航栏
│       ├── tab-bar/            # 自定义底部栏
│       ├── page-container/     # 页面容器
│       └── safe-area/          # 安全区域
│
├── pages/                      # 页面
│   ├── index/                  # 首页
│   ├── login/                  # 登录页
│   ├── travel/                 # 旅游页
│   │   └── index/              # 旅游首页（跟团游/定制游）
│   ├── custom/                 # 定制游
│   │   └── list/               # 定制需求列表
│   ├── route/                  # 线路相关
│   │   ├── list/               # 线路列表
│   │   └── detail/             # 线路详情
│   ├── order/                  # 订单相关
│   │   ├── confirm/            # 订单确认
│   │   ├── list/               # 订单列表
│   │   ├── detail/             # 订单详情
│   │   └── refund/             # 退款申请
│   ├── companion/              # 搭子（同行）
│   │   ├── list/
│   │   └── detail/
│   ├── trip/                   # 行程
│   │   └── list/
│   ├── member/                 # 会员中心
│   │   ├── index/              # 我的
│   │   ├── profile/            # 个人信息
│   │   ├── travelers/          # 出行人管理
│   │   ├── favorite/           # 我的收藏
│   │   ├── coupon/             # 优惠券
│   │   └── settings/           # 设置
│   ├── promoter/               # 推广员
│   │   ├── apply/              # 申请
│   │   ├── center/             # 推广中心
│   │   └── bindList/           # 绑定用户
│   ├── message/                # 消息中心
│   │   └── list/
│   └── webview/                # 内嵌网页
│
├── services/                   # API服务层
│   ├── request.js              # 请求封装
│   ├── user.js                 # 用户相关API
│   ├── route.js                # 线路相关API
│   ├── order.js                # 订单相关API
│   ├── home.js                 # 首页相关API
│   ├── custom.js               # 定制游相关API
│   ├── companion.js            # 搭子相关API
│   ├── promoter.js             # 推广员相关API
│   └── common.js               # 公共API
│
├── utils/                      # 工具函数
│   ├── util.js                 # 通用工具
│   ├── storage.js              # 存储封装
│   ├── auth.js                 # 登录态管理
│   ├── router.js               # 路由封装
│   ├── format.js               # 格式化工具
│   └── validate.js             # 表单验证
│
├── assets/                     # 静态资源
│   ├── icons/                  # 图标
│   ├── images/                 # 图片
│   └── index.js                # 资源路径配置
│
└── behaviors/                  # 公共行为
    ├── pagination.js           # 分页行为
    └── form-validate.js        # 表单验证行为
```

---

## 三、Design Token 系统

### 3.1 设计令牌定义

```javascript
// config/design-tokens.js

module.exports = {
  // ========================
  // 颜色系统 (Colors)
  // ========================
  colors: {
    // 品牌色
    primary: '#1890FF',           // 主色调
    primaryLight: '#E6F7FF',      // 主色浅
    primaryDark: '#096DD9',       // 主色深

    // 功能色
    success: '#52C41A',           // 成功
    successLight: '#F6FFED',
    warning: '#FAAD14',           // 警告
    warningLight: '#FFFBE6',
    error: '#FF4D4F',             // 错误
    errorLight: '#FFF2F0',
    info: '#1890FF',              // 信息

    // 中性色 - 文字
    textPrimary: '#333333',       // 主要文字
    textSecondary: '#666666',     // 次要文字
    textTertiary: '#999999',      // 辅助文字
    textPlaceholder: '#CCCCCC',   // 占位符
    textInverse: '#FFFFFF',       // 反色文字

    // 中性色 - 背景
    bgPage: '#F5F5F5',            // 页面背景
    bgCard: '#FFFFFF',            // 卡片背景
    bgGray: '#FAFAFA',            // 灰色背景
    bgMask: 'rgba(0,0,0,0.5)',    // 遮罩层

    // 中性色 - 边框分割线
    border: '#E8E8E8',            // 边框
    borderLight: '#F0F0F0',       // 浅边框
    divider: '#EEEEEE',           // 分割线
  },

  // ========================
  // 字体系统 (Typography)
  // ========================
  fonts: {
    // 字号
    sizeXs: '20rpx',              // 极小 - 辅助文字
    sizeSm: '24rpx',              // 小 - 次要文字
    sizeMd: '28rpx',              // 中 - 正文（默认）
    sizeLg: '32rpx',              // 大 - 小标题
    sizeXl: '36rpx',              // 特大 - 标题
    sizeXxl: '44rpx',             // 超大 - 大标题
    sizePrice: '40rpx',           // 价格专用

    // 字重
    weightNormal: '400',          // 常规
    weightMedium: '500',          // 中等
    weightSemibold: '600',        // 半粗
    weightBold: '700',            // 粗体

    // 行高
    lineHeightTight: '1.2',       // 紧凑
    lineHeightNormal: '1.5',      // 常规
    lineHeightLoose: '1.8',       // 宽松
  },

  // ========================
  // 间距系统 (Spacing)
  // ========================
  spacing: {
    xs: '8rpx',                   // 4px - 极小
    sm: '16rpx',                  // 8px - 小
    md: '24rpx',                  // 12px - 中
    lg: '32rpx',                  // 16px - 大
    xl: '48rpx',                  // 24px - 特大
    xxl: '64rpx',                 // 32px - 超大

    // 页面边距
    pagePadding: '32rpx',         // 页面左右边距
    cardPadding: '24rpx',         // 卡片内边距
    sectionGap: '24rpx',          // 区块间距
  },

  // ========================
  // 圆角系统 (Radius)
  // ========================
  radius: {
    none: '0',
    xs: '4rpx',                   // 极小圆角
    sm: '8rpx',                   // 小圆角
    md: '16rpx',                  // 中圆角（默认）
    lg: '24rpx',                  // 大圆角
    xl: '32rpx',                  // 特大圆角
    full: '9999rpx',              // 全圆（胶囊）
  },

  // ========================
  // 阴影系统 (Shadows)
  // ========================
  shadows: {
    none: 'none',
    sm: '0 2rpx 8rpx rgba(0, 0, 0, 0.08)',      // 轻微阴影
    md: '0 4rpx 16rpx rgba(0, 0, 0, 0.12)',     // 中等阴影
    lg: '0 8rpx 32rpx rgba(0, 0, 0, 0.16)',     // 较深阴影
    xl: '0 16rpx 48rpx rgba(0, 0, 0, 0.20)',    // 深阴影
  },

  // ========================
  // 动画系统 (Animation)
  // ========================
  animation: {
    durationFast: '150ms',
    durationNormal: '300ms',
    durationSlow: '500ms',

    easingDefault: 'ease',
    easingIn: 'ease-in',
    easingOut: 'ease-out',
    easingInOut: 'ease-in-out',
  },

  // ========================
  // 层级系统 (Z-Index)
  // ========================
  zIndex: {
    default: 1,
    dropdown: 100,
    sticky: 200,
    fixed: 300,
    modalBackdrop: 400,
    modal: 500,
    popover: 600,
    tooltip: 700,
    toast: 800,
  },

  // ========================
  // 组件尺寸 (Component Size)
  // ========================
  components: {
    // 按钮
    button: {
      heightSm: '56rpx',
      heightMd: '72rpx',
      heightLg: '88rpx',
    },

    // 输入框
    input: {
      height: '88rpx',
    },

    // 头像
    avatar: {
      sizeSm: '48rpx',
      sizeMd: '64rpx',
      sizeLg: '96rpx',
      sizeXl: '128rpx',
    },

    // 图标
    icon: {
      sizeSm: '32rpx',
      sizeMd: '40rpx',
      sizeLg: '48rpx',
    },

    // 导航栏
    navBar: {
      height: '88rpx',
    },

    // 底部栏
    tabBar: {
      height: '100rpx',
    },
  },
};
```

### 3.2 CSS变量生成

```css
/* styles/variables.wxss */
/* 此文件由 design-tokens.js 生成，请勿手动修改 */

page {
  /* ===== 颜色 ===== */
  --color-primary: #1890FF;
  --color-primary-light: #E6F7FF;
  --color-primary-dark: #096DD9;

  --color-success: #52C41A;
  --color-success-light: #F6FFED;
  --color-warning: #FAAD14;
  --color-warning-light: #FFFBE6;
  --color-error: #FF4D4F;
  --color-error-light: #FFF2F0;

  --color-text-primary: #333333;
  --color-text-secondary: #666666;
  --color-text-tertiary: #999999;
  --color-text-placeholder: #CCCCCC;
  --color-text-inverse: #FFFFFF;

  --color-bg-page: #F5F5F5;
  --color-bg-card: #FFFFFF;
  --color-bg-gray: #FAFAFA;
  --color-bg-mask: rgba(0,0,0,0.5);

  --color-border: #E8E8E8;
  --color-border-light: #F0F0F0;
  --color-divider: #EEEEEE;

  /* ===== 字体 ===== */
  --font-size-xs: 20rpx;
  --font-size-sm: 24rpx;
  --font-size-md: 28rpx;
  --font-size-lg: 32rpx;
  --font-size-xl: 36rpx;
  --font-size-xxl: 44rpx;
  --font-size-price: 40rpx;

  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;

  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --line-height-loose: 1.8;

  /* ===== 间距 ===== */
  --spacing-xs: 8rpx;
  --spacing-sm: 16rpx;
  --spacing-md: 24rpx;
  --spacing-lg: 32rpx;
  --spacing-xl: 48rpx;
  --spacing-xxl: 64rpx;

  --page-padding: 32rpx;
  --card-padding: 24rpx;
  --section-gap: 24rpx;

  /* ===== 圆角 ===== */
  --radius-xs: 4rpx;
  --radius-sm: 8rpx;
  --radius-md: 16rpx;
  --radius-lg: 24rpx;
  --radius-xl: 32rpx;
  --radius-full: 9999rpx;

  /* ===== 阴影 ===== */
  --shadow-sm: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);
  --shadow-md: 0 4rpx 16rpx rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 8rpx 32rpx rgba(0, 0, 0, 0.16);
  --shadow-xl: 0 16rpx 48rpx rgba(0, 0, 0, 0.20);

  /* ===== 动画 ===== */
  --duration-fast: 150ms;
  --duration-normal: 300ms;
  --duration-slow: 500ms;

  /* ===== 组件尺寸 ===== */
  --button-height-sm: 56rpx;
  --button-height-md: 72rpx;
  --button-height-lg: 88rpx;

  --input-height: 88rpx;

  --avatar-size-sm: 48rpx;
  --avatar-size-md: 64rpx;
  --avatar-size-lg: 96rpx;
  --avatar-size-xl: 128rpx;

  --icon-size-sm: 32rpx;
  --icon-size-md: 40rpx;
  --icon-size-lg: 48rpx;

  --nav-bar-height: 88rpx;
  --tab-bar-height: 100rpx;
}
```

### 3.3 主题切换支持

```javascript
// config/theme.js

const designTokens = require('./design-tokens');

// 预定义主题
const themes = {
  // 默认主题（蓝色系）
  default: {
    ...designTokens.colors,
  },

  // 自然主题（绿色系 - 户外旅行风格）
  nature: {
    primary: '#52C41A',
    primaryLight: '#F6FFED',
    primaryDark: '#389E0D',
    // 其他颜色保持不变
  },

  // 暖色主题（橙色系 - 活力风格）
  warm: {
    primary: '#FA8C16',
    primaryLight: '#FFF7E6',
    primaryDark: '#D46B08',
  },

  // 深色主题
  dark: {
    textPrimary: '#FFFFFF',
    textSecondary: '#CCCCCC',
    textTertiary: '#999999',
    bgPage: '#1A1A1A',
    bgCard: '#2D2D2D',
    border: '#404040',
  },
};

// 当前主题
let currentTheme = 'default';

/**
 * 主题管理器
 */
const ThemeManager = {
  /**
   * 获取当前主题名称
   */
  getCurrentTheme() {
    return currentTheme;
  },

  /**
   * 切换主题
   * @param {string} themeName - 主题名称
   */
  setTheme(themeName) {
    if (!themes[themeName]) {
      console.warn(`Theme "${themeName}" not found, using default.`);
      themeName = 'default';
    }

    currentTheme = themeName;
    this.applyTheme(themeName);

    // 持久化存储
    wx.setStorageSync('theme', themeName);
  },

  /**
   * 应用主题到页面
   */
  applyTheme(themeName) {
    const theme = themes[themeName];
    const pages = getCurrentPages();

    if (pages.length > 0) {
      const currentPage = pages[pages.length - 1];
      // 通过setData更新CSS变量
      currentPage.setData({
        themeVars: this.generateCSSVars(theme)
      });
    }
  },

  /**
   * 生成CSS变量字符串
   */
  generateCSSVars(theme) {
    let cssVars = '';
    for (const [key, value] of Object.entries(theme)) {
      const cssKey = this.camelToKebab(key);
      cssVars += `--color-${cssKey}: ${value}; `;
    }
    return cssVars;
  },

  /**
   * 驼峰转连字符
   */
  camelToKebab(str) {
    return str.replace(/([A-Z])/g, '-$1').toLowerCase();
  },

  /**
   * 初始化主题（在app.js中调用）
   */
  init() {
    const savedTheme = wx.getStorageSync('theme') || 'default';
    currentTheme = savedTheme;
    return savedTheme;
  }
};

module.exports = ThemeManager;
```

---

## 四、组件设计规范

### 4.1 组件开发原则

1. **单一职责**：每个组件只做一件事
2. **Props驱动**：通过properties配置，避免硬编码
3. **样式隔离**：使用CSS变量，不直接写颜色值
4. **插槽扩展**：提供slot支持内容定制
5. **事件通信**：通过triggerEvent向外传递事件

### 4.2 基础组件示例

#### 4.2.1 xj-button 按钮组件

```
components/base/xj-button/
├── index.js
├── index.json
├── index.wxml
└── index.wxss
```

**index.json**
```json
{
  "component": true,
  "styleIsolation": "apply-shared"
}
```

**index.js**
```javascript
Component({
  options: {
    multipleSlots: true,
    addGlobalClass: true
  },

  properties: {
    // 按钮类型: primary | secondary | outline | text | danger
    type: {
      type: String,
      value: 'primary'
    },
    // 按钮尺寸: sm | md | lg
    size: {
      type: String,
      value: 'md'
    },
    // 是否块级按钮
    block: {
      type: Boolean,
      value: false
    },
    // 是否禁用
    disabled: {
      type: Boolean,
      value: false
    },
    // 是否加载中
    loading: {
      type: Boolean,
      value: false
    },
    // 圆角类型: default | round | square
    shape: {
      type: String,
      value: 'default'
    },
    // 自定义类名
    customClass: {
      type: String,
      value: ''
    },
    // 开放能力
    openType: {
      type: String,
      value: ''
    }
  },

  methods: {
    handleTap(e) {
      if (this.data.disabled || this.data.loading) return;
      this.triggerEvent('tap', e);
    },

    // 开放能力回调
    handleGetUserInfo(e) {
      this.triggerEvent('getuserinfo', e.detail);
    },
    handleContact(e) {
      this.triggerEvent('contact', e.detail);
    },
    handleGetPhoneNumber(e) {
      this.triggerEvent('getphonenumber', e.detail);
    }
  }
});
```

**index.wxml**
```xml
<button
  class="xj-btn xj-btn--{{type}} xj-btn--{{size}} {{block ? 'xj-btn--block' : ''}} {{shape === 'round' ? 'xj-btn--round' : ''}} {{shape === 'square' ? 'xj-btn--square' : ''}} {{disabled ? 'xj-btn--disabled' : ''}} {{loading ? 'xj-btn--loading' : ''}} {{customClass}}"
  disabled="{{disabled || loading}}"
  open-type="{{openType}}"
  bindtap="handleTap"
  bindgetuserinfo="handleGetUserInfo"
  bindcontact="handleContact"
  bindgetphonenumber="handleGetPhoneNumber"
>
  <view class="xj-btn__content">
    <view wx:if="{{loading}}" class="xj-btn__loading"></view>
    <slot name="icon"></slot>
    <view class="xj-btn__text">
      <slot></slot>
    </view>
  </view>
</button>
```

**index.wxss**
```css
/* 基础样式 */
.xj-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0 var(--spacing-lg);
  border: none;
  border-radius: var(--radius-md);
  font-size: var(--font-size-md);
  font-weight: var(--font-weight-medium);
  line-height: 1;
  transition: all var(--duration-fast);
  box-sizing: border-box;
}

.xj-btn::after {
  border: none;
}

.xj-btn__content {
  display: flex;
  align-items: center;
  justify-content: center;
}

.xj-btn__text {
  display: flex;
  align-items: center;
}

/* 尺寸 */
.xj-btn--sm {
  height: var(--button-height-sm);
  padding: 0 var(--spacing-md);
  font-size: var(--font-size-sm);
}

.xj-btn--md {
  height: var(--button-height-md);
}

.xj-btn--lg {
  height: var(--button-height-lg);
  font-size: var(--font-size-lg);
}

/* 类型 - Primary */
.xj-btn--primary {
  background: var(--color-primary);
  color: var(--color-text-inverse);
}

.xj-btn--primary:active {
  background: var(--color-primary-dark);
}

/* 类型 - Secondary */
.xj-btn--secondary {
  background: var(--color-primary-light);
  color: var(--color-primary);
}

/* 类型 - Outline */
.xj-btn--outline {
  background: transparent;
  color: var(--color-primary);
  border: 2rpx solid var(--color-primary);
}

/* 类型 - Text */
.xj-btn--text {
  background: transparent;
  color: var(--color-primary);
  padding: 0;
}

/* 类型 - Danger */
.xj-btn--danger {
  background: var(--color-error);
  color: var(--color-text-inverse);
}

/* 块级按钮 */
.xj-btn--block {
  display: flex;
  width: 100%;
}

/* 圆角 */
.xj-btn--round {
  border-radius: var(--radius-full);
}

.xj-btn--square {
  border-radius: 0;
}

/* 禁用状态 */
.xj-btn--disabled {
  opacity: 0.5;
  pointer-events: none;
}

/* 加载中 */
.xj-btn--loading {
  pointer-events: none;
}

.xj-btn__loading {
  width: 32rpx;
  height: 32rpx;
  margin-right: var(--spacing-xs);
  border: 4rpx solid currentColor;
  border-top-color: transparent;
  border-radius: 50%;
  animation: xj-btn-spin 0.8s linear infinite;
}

@keyframes xj-btn-spin {
  to {
    transform: rotate(360deg);
  }
}
```

#### 4.2.2 xj-card 卡片组件

**index.js**
```javascript
Component({
  options: {
    multipleSlots: true,
    addGlobalClass: true
  },

  properties: {
    // 是否显示边框
    bordered: {
      type: Boolean,
      value: false
    },
    // 是否显示阴影
    shadow: {
      type: String,
      value: 'sm' // none | sm | md | lg
    },
    // 内边距
    padding: {
      type: String,
      value: 'md' // none | sm | md | lg
    },
    // 圆角
    radius: {
      type: String,
      value: 'md'
    },
    // 是否可点击
    clickable: {
      type: Boolean,
      value: false
    }
  },

  methods: {
    handleTap() {
      if (this.data.clickable) {
        this.triggerEvent('tap');
      }
    }
  }
});
```

**index.wxml**
```xml
<view
  class="xj-card xj-card--shadow-{{shadow}} xj-card--padding-{{padding}} xj-card--radius-{{radius}} {{bordered ? 'xj-card--bordered' : ''}} {{clickable ? 'xj-card--clickable' : ''}}"
  bindtap="handleTap"
>
  <view wx:if="{{false}}" class="xj-card__header">
    <slot name="header"></slot>
  </view>
  <view class="xj-card__body">
    <slot></slot>
  </view>
  <view wx:if="{{false}}" class="xj-card__footer">
    <slot name="footer"></slot>
  </view>
</view>
```

**index.wxss**
```css
.xj-card {
  background: var(--color-bg-card);
  box-sizing: border-box;
}

/* 阴影 */
.xj-card--shadow-none {
  box-shadow: none;
}

.xj-card--shadow-sm {
  box-shadow: var(--shadow-sm);
}

.xj-card--shadow-md {
  box-shadow: var(--shadow-md);
}

.xj-card--shadow-lg {
  box-shadow: var(--shadow-lg);
}

/* 内边距 */
.xj-card--padding-none {
  padding: 0;
}

.xj-card--padding-sm {
  padding: var(--spacing-sm);
}

.xj-card--padding-md {
  padding: var(--card-padding);
}

.xj-card--padding-lg {
  padding: var(--spacing-lg);
}

/* 圆角 */
.xj-card--radius-none {
  border-radius: 0;
}

.xj-card--radius-sm {
  border-radius: var(--radius-sm);
}

.xj-card--radius-md {
  border-radius: var(--radius-md);
}

.xj-card--radius-lg {
  border-radius: var(--radius-lg);
}

/* 边框 */
.xj-card--bordered {
  border: 2rpx solid var(--color-border);
}

/* 可点击 */
.xj-card--clickable {
  transition: transform var(--duration-fast);
}

.xj-card--clickable:active {
  transform: scale(0.98);
  opacity: 0.9;
}
```

### 4.3 业务组件示例

#### 4.3.1 route-card 线路卡片

```
components/business/route-card/
├── index.js
├── index.json
├── index.wxml
└── index.wxss
```

**index.js**
```javascript
Component({
  options: {
    addGlobalClass: true
  },

  properties: {
    // 线路数据
    route: {
      type: Object,
      value: {}
    },
    // 卡片模式: normal | compact | horizontal
    mode: {
      type: String,
      value: 'normal'
    },
    // 是否显示收藏按钮
    showFavorite: {
      type: Boolean,
      value: true
    }
  },

  methods: {
    handleTap() {
      this.triggerEvent('tap', { route: this.data.route });
    },

    handleFavorite(e) {
      // 阻止冒泡
      e.stopPropagation && e.stopPropagation();
      this.triggerEvent('favorite', {
        route: this.data.route,
        isFavorite: !this.data.route.isFavorite
      });
    }
  }
});
```

**index.wxml**
```xml
<view class="route-card route-card--{{mode}}" bindtap="handleTap">
  <!-- 图片区域 -->
  <view class="route-card__image-wrap">
    <image
      class="route-card__image"
      src="{{route.coverImage}}"
      mode="aspectFill"
    />
    <view wx:if="{{route.tags && route.tags.length}}" class="route-card__tags">
      <view
        wx:for="{{route.tags}}"
        wx:key="index"
        class="route-card__tag"
      >{{item}}</view>
    </view>
    <view
      wx:if="{{showFavorite}}"
      class="route-card__favorite {{route.isFavorite ? 'is-active' : ''}}"
      catchtap="handleFavorite"
    >
      <text class="route-card__favorite-icon">{{route.isFavorite ? '♥' : '♡'}}</text>
    </view>
  </view>

  <!-- 内容区域 -->
  <view class="route-card__content">
    <view class="route-card__title">{{route.title}}</view>
    <view class="route-card__info">
      <text class="route-card__duration">{{route.duration}}</text>
      <text class="route-card__sales">已售{{route.salesCount}}人</text>
    </view>
    <view class="route-card__bottom">
      <view class="route-card__price">
        <text class="route-card__price-symbol">¥</text>
        <text class="route-card__price-value">{{route.price}}</text>
        <text class="route-card__price-unit">/人起</text>
      </view>
      <view wx:if="{{route.originPrice}}" class="route-card__origin-price">
        ¥{{route.originPrice}}
      </view>
    </view>
  </view>
</view>
```

**index.wxss**
```css
.route-card {
  background: var(--color-bg-card);
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}

/* Normal 模式（垂直布局） */
.route-card--normal .route-card__image-wrap {
  position: relative;
  width: 100%;
  height: 360rpx;
}

.route-card--normal .route-card__image {
  width: 100%;
  height: 100%;
}

/* Compact 模式（紧凑垂直） */
.route-card--compact .route-card__image-wrap {
  height: 280rpx;
}

/* Horizontal 模式（水平布局） */
.route-card--horizontal {
  display: flex;
  flex-direction: row;
}

.route-card--horizontal .route-card__image-wrap {
  width: 240rpx;
  height: 180rpx;
  flex-shrink: 0;
}

.route-card--horizontal .route-card__content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* 图片 */
.route-card__image {
  width: 100%;
  height: 100%;
}

/* 标签 */
.route-card__tags {
  position: absolute;
  top: var(--spacing-sm);
  left: var(--spacing-sm);
  display: flex;
  gap: var(--spacing-xs);
}

.route-card__tag {
  padding: 4rpx 12rpx;
  background: rgba(0, 0, 0, 0.5);
  color: var(--color-text-inverse);
  font-size: var(--font-size-xs);
  border-radius: var(--radius-xs);
}

/* 收藏按钮 */
.route-card__favorite {
  position: absolute;
  top: var(--spacing-sm);
  right: var(--spacing-sm);
  width: 56rpx;
  height: 56rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
}

.route-card__favorite-icon {
  font-size: 32rpx;
  color: var(--color-text-tertiary);
}

.route-card__favorite.is-active .route-card__favorite-icon {
  color: var(--color-error);
}

/* 内容区域 */
.route-card__content {
  padding: var(--card-padding);
}

.route-card__title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-primary);
  line-height: var(--line-height-tight);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.route-card__info {
  margin-top: var(--spacing-sm);
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  font-size: var(--font-size-sm);
  color: var(--color-text-tertiary);
}

.route-card__bottom {
  margin-top: var(--spacing-md);
  display: flex;
  align-items: baseline;
  gap: var(--spacing-sm);
}

.route-card__price {
  display: flex;
  align-items: baseline;
  color: var(--color-error);
}

.route-card__price-symbol {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
}

.route-card__price-value {
  font-size: var(--font-size-price);
  font-weight: var(--font-weight-bold);
}

.route-card__price-unit {
  font-size: var(--font-size-xs);
  color: var(--color-text-tertiary);
  margin-left: 4rpx;
}

.route-card__origin-price {
  font-size: var(--font-size-sm);
  color: var(--color-text-placeholder);
  text-decoration: line-through;
}
```

### 4.4 布局组件示例

#### 4.4.1 nav-bar 自定义导航栏

**index.js**
```javascript
Component({
  options: {
    multipleSlots: true,
    addGlobalClass: true
  },

  properties: {
    // 标题
    title: {
      type: String,
      value: ''
    },
    // 背景色
    background: {
      type: String,
      value: '#FFFFFF'
    },
    // 文字颜色: light | dark
    theme: {
      type: String,
      value: 'dark'
    },
    // 是否显示返回按钮
    showBack: {
      type: Boolean,
      value: true
    },
    // 是否固定在顶部
    fixed: {
      type: Boolean,
      value: true
    },
    // 是否显示底部边框
    border: {
      type: Boolean,
      value: true
    }
  },

  data: {
    statusBarHeight: 0,
    navBarHeight: 44
  },

  lifetimes: {
    attached() {
      const systemInfo = wx.getSystemInfoSync();
      const menuButton = wx.getMenuButtonBoundingClientRect();

      this.setData({
        statusBarHeight: systemInfo.statusBarHeight,
        navBarHeight: menuButton.height + (menuButton.top - systemInfo.statusBarHeight) * 2
      });
    }
  },

  methods: {
    handleBack() {
      const pages = getCurrentPages();
      if (pages.length > 1) {
        wx.navigateBack();
      } else {
        wx.switchTab({ url: '/pages/index/index' });
      }
      this.triggerEvent('back');
    }
  }
});
```

**index.wxml**
```xml
<view
  class="nav-bar nav-bar--{{theme}} {{fixed ? 'nav-bar--fixed' : ''}} {{border ? 'nav-bar--border' : ''}}"
  style="background: {{background}}; padding-top: {{statusBarHeight}}px;"
>
  <!-- 状态栏占位 -->
  <view style="height: {{statusBarHeight}}px;"></view>

  <!-- 导航栏内容 -->
  <view class="nav-bar__content" style="height: {{navBarHeight}}px;">
    <!-- 左侧区域 -->
    <view class="nav-bar__left">
      <view wx:if="{{showBack}}" class="nav-bar__back" bindtap="handleBack">
        <view class="nav-bar__back-icon"></view>
      </view>
      <slot name="left"></slot>
    </view>

    <!-- 标题区域 -->
    <view class="nav-bar__title">
      <slot name="title">
        <text>{{title}}</text>
      </slot>
    </view>

    <!-- 右侧区域 -->
    <view class="nav-bar__right">
      <slot name="right"></slot>
    </view>
  </view>
</view>

<!-- 占位元素（fixed时使用） -->
<view
  wx:if="{{fixed}}"
  class="nav-bar__placeholder"
  style="height: {{statusBarHeight + navBarHeight}}px;"
></view>
```

**index.wxss**
```css
.nav-bar {
  width: 100%;
  z-index: var(--z-index-fixed, 300);
}

.nav-bar--fixed {
  position: fixed;
  top: 0;
  left: 0;
}

.nav-bar--border {
  border-bottom: 1rpx solid var(--color-border-light);
}

.nav-bar__content {
  display: flex;
  align-items: center;
  padding: 0 var(--spacing-sm);
}

.nav-bar__left,
.nav-bar__right {
  display: flex;
  align-items: center;
  min-width: 100rpx;
}

.nav-bar__right {
  justify-content: flex-end;
}

.nav-bar__title {
  flex: 1;
  text-align: center;
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-medium);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 返回按钮 */
.nav-bar__back {
  padding: var(--spacing-sm);
  margin-left: calc(-1 * var(--spacing-sm));
}

.nav-bar__back-icon {
  width: 20rpx;
  height: 20rpx;
  border-left: 4rpx solid currentColor;
  border-bottom: 4rpx solid currentColor;
  transform: rotate(45deg);
}

/* 主题 - 深色文字 */
.nav-bar--dark {
  color: var(--color-text-primary);
}

/* 主题 - 浅色文字 */
.nav-bar--light {
  color: var(--color-text-inverse);
}

/* 占位 */
.nav-bar__placeholder {
  width: 100%;
}
```

---

## 五、API服务层设计

### 5.1 请求封装

```javascript
// services/request.js

const apiConfig = require('../config/api');
const { getToken, clearToken } = require('../utils/auth');

/**
 * 请求封装
 */
const request = (options) => {
  return new Promise((resolve, reject) => {
    const token = getToken();

    wx.request({
      url: apiConfig.baseUrl + options.url,
      method: options.method || 'GET',
      data: options.data || {},
      header: {
        'Content-Type': 'application/json',
        'Authorization': token ? `Bearer ${token}` : '',
        ...options.header
      },
      timeout: options.timeout || 30000,

      success: (res) => {
        const { statusCode, data } = res;

        // HTTP状态码处理
        if (statusCode === 200) {
          // 业务状态码处理
          if (data.code === 200 || data.code === 0) {
            resolve(data.data);
          } else if (data.code === 401) {
            // 登录过期
            clearToken();
            wx.showToast({ title: '登录已过期', icon: 'none' });
            // 跳转登录页
            setTimeout(() => {
              wx.navigateTo({ url: '/pages/login/index' });
            }, 1500);
            reject(data);
          } else {
            // 业务错误
            wx.showToast({
              title: data.message || '操作失败',
              icon: 'none'
            });
            reject(data);
          }
        } else {
          reject({ code: statusCode, message: 'HTTP Error' });
        }
      },

      fail: (err) => {
        wx.showToast({ title: '网络异常', icon: 'none' });
        reject(err);
      }
    });
  });
};

// 便捷方法
const get = (url, data, options = {}) => {
  return request({ url, method: 'GET', data, ...options });
};

const post = (url, data, options = {}) => {
  return request({ url, method: 'POST', data, ...options });
};

const put = (url, data, options = {}) => {
  return request({ url, method: 'PUT', data, ...options });
};

const del = (url, data, options = {}) => {
  return request({ url, method: 'DELETE', data, ...options });
};

module.exports = {
  request,
  get,
  post,
  put,
  del
};
```

### 5.2 API配置

```javascript
// config/api.js

// 环境配置
const ENV = {
  dev: {
    baseUrl: 'http://localhost:8080/api',
  },
  test: {
    baseUrl: 'https://test-api.xunjiqianxing.com/api',
  },
  prod: {
    baseUrl: 'https://api.xunjiqianxing.com/api',
  }
};

// 当前环境
const currentEnv = 'dev';

module.exports = {
  env: currentEnv,
  baseUrl: ENV[currentEnv].baseUrl,

  // API路径
  paths: {
    // 用户模块
    user: {
      login: '/user/login',
      info: '/user/info',
      update: '/user/update',
    },
    // 首页模块
    home: {
      data: '/home/data',
      banners: '/home/banners',
    },
    // 线路模块
    route: {
      list: '/route/list',
      detail: '/route/detail',
      calendar: '/route/calendar',
      favorite: '/route/favorite',
    },
    // 订单模块
    order: {
      create: '/order/create',
      list: '/order/list',
      detail: '/order/detail',
      cancel: '/order/cancel',
      pay: '/order/pay',
      refund: '/order/refund',
    },
    // 更多模块...
  }
};
```

### 5.3 业务API示例

```javascript
// services/route.js

const { get, post } = require('./request');
const { paths } = require('../config/api');

/**
 * 线路相关API
 */
const routeApi = {
  /**
   * 获取线路列表
   * @param {Object} params - 查询参数
   * @param {number} params.page - 页码
   * @param {number} params.pageSize - 每页数量
   * @param {string} params.keyword - 搜索关键词
   * @param {number} params.categoryId - 分类ID
   */
  getList(params) {
    return get(paths.route.list, params);
  },

  /**
   * 获取线路详情
   * @param {number} id - 线路ID
   */
  getDetail(id) {
    return get(`${paths.route.detail}/${id}`);
  },

  /**
   * 获取价格日历
   * @param {number} routeId - 线路ID
   * @param {string} month - 月份 (YYYY-MM)
   */
  getCalendar(routeId, month) {
    return get(paths.route.calendar, { routeId, month });
  },

  /**
   * 收藏/取消收藏
   * @param {number} routeId - 线路ID
   */
  toggleFavorite(routeId) {
    return post(paths.route.favorite, { routeId });
  },
};

module.exports = routeApi;
```

---

## 六、资源管理

### 6.1 资源目录结构

```
assets/
├── icons/                    # 图标资源
│   ├── tabbar/              # 底部导航图标
│   │   ├── home.png
│   │   ├── home-active.png
│   │   ├── companion.png
│   │   ├── companion-active.png
│   │   ├── trip.png
│   │   ├── trip-active.png
│   │   ├── member.png
│   │   └── member-active.png
│   ├── common/              # 通用图标
│   │   ├── arrow-right.png
│   │   ├── arrow-left.png
│   │   ├── close.png
│   │   ├── search.png
│   │   ├── share.png
│   │   ├── favorite.png
│   │   ├── favorite-active.png
│   │   └── ...
│   └── order/               # 订单相关图标
│       ├── status-pending.png
│       ├── status-confirmed.png
│       └── ...
│
├── images/                   # 图片资源
│   ├── logo.png             # Logo
│   ├── empty/               # 空状态图
│   │   ├── empty-default.png
│   │   ├── empty-order.png
│   │   ├── empty-favorite.png
│   │   └── empty-network.png
│   ├── placeholder/         # 占位图
│   │   ├── route.png
│   │   └── avatar.png
│   └── bg/                  # 背景图
│       └── member-header.png
│
└── index.js                  # 资源路径配置
```

### 6.2 资源路径配置

```javascript
// assets/index.js

const BASE_PATH = '/assets';

/**
 * 静态资源路径配置
 * 集中管理便于后期统一修改
 */
const assets = {
  // TabBar图标
  tabbar: {
    home: `${BASE_PATH}/icons/tabbar/home.png`,
    homeActive: `${BASE_PATH}/icons/tabbar/home-active.png`,
    companion: `${BASE_PATH}/icons/tabbar/companion.png`,
    companionActive: `${BASE_PATH}/icons/tabbar/companion-active.png`,
    trip: `${BASE_PATH}/icons/tabbar/trip.png`,
    tripActive: `${BASE_PATH}/icons/tabbar/trip-active.png`,
    member: `${BASE_PATH}/icons/tabbar/member.png`,
    memberActive: `${BASE_PATH}/icons/tabbar/member-active.png`,
  },

  // 通用图标
  icons: {
    arrowRight: `${BASE_PATH}/icons/common/arrow-right.png`,
    arrowLeft: `${BASE_PATH}/icons/common/arrow-left.png`,
    close: `${BASE_PATH}/icons/common/close.png`,
    search: `${BASE_PATH}/icons/common/search.png`,
    share: `${BASE_PATH}/icons/common/share.png`,
    favorite: `${BASE_PATH}/icons/common/favorite.png`,
    favoriteActive: `${BASE_PATH}/icons/common/favorite-active.png`,
    location: `${BASE_PATH}/icons/common/location.png`,
    phone: `${BASE_PATH}/icons/common/phone.png`,
    time: `${BASE_PATH}/icons/common/time.png`,
  },

  // 空状态图
  empty: {
    default: `${BASE_PATH}/images/empty/empty-default.png`,
    order: `${BASE_PATH}/images/empty/empty-order.png`,
    favorite: `${BASE_PATH}/images/empty/empty-favorite.png`,
    network: `${BASE_PATH}/images/empty/empty-network.png`,
    search: `${BASE_PATH}/images/empty/empty-search.png`,
  },

  // 占位图
  placeholder: {
    route: `${BASE_PATH}/images/placeholder/route.png`,
    avatar: `${BASE_PATH}/images/placeholder/avatar.png`,
  },

  // 其他图片
  images: {
    logo: `${BASE_PATH}/images/logo.png`,
    memberHeaderBg: `${BASE_PATH}/images/bg/member-header.png`,
  },
};

module.exports = assets;
```

### 6.3 资源使用示例

```javascript
// pages/member/index/index.js
const assets = require('../../../assets/index');

Page({
  data: {
    assets: assets,  // 将资源配置传入页面
  }
});
```

```xml
<!-- pages/member/index/index.wxml -->
<image src="{{assets.images.memberHeaderBg}}" class="header-bg" />
<image src="{{assets.placeholder.avatar}}" class="avatar" />
```

---

## 七、功能配置

### 7.1 应用配置

```javascript
// config/app.config.js

module.exports = {
  // ========================
  // 应用信息
  // ========================
  app: {
    name: '寻迹千行',
    version: '1.0.0',
    description: '户外旅行线路预订平台',
  },

  // ========================
  // 功能开关
  // ========================
  features: {
    // 推广员功能
    promoter: {
      enabled: true,
      applyEnabled: true,  // 是否开放申请
    },
    // 搭子（同行）功能
    companion: {
      enabled: true,
    },
    // 会员等级功能
    memberLevel: {
      enabled: true,
    },
    // 优惠券功能
    coupon: {
      enabled: true,
    },
    // 评价功能
    review: {
      enabled: true,
    },
    // 客服功能
    customerService: {
      enabled: true,
      type: 'weixin',  // weixin | phone | both
      phone: '400-xxx-xxxx',
    },
  },

  // ========================
  // 首页模块配置
  // ========================
  homeModules: [
    {
      type: 'banner',
      visible: true,
    },
    {
      type: 'search',
      visible: true,
      placeholder: '搜索目的地、线路名称',
    },
    {
      type: 'category',
      visible: true,
      title: '热门分类',
    },
    {
      type: 'hotRoutes',
      visible: true,
      title: '热门线路',
      showMore: true,
    },
    {
      type: 'newRoutes',
      visible: true,
      title: '最新上线',
      showMore: true,
    },
  ],

  // ========================
  // 分享配置
  // ========================
  share: {
    defaultTitle: '寻迹千行 - 发现不一样的旅行',
    defaultImage: '/assets/images/share-default.png',
  },

  // ========================
  // 订单配置
  // ========================
  order: {
    // 待支付订单超时时间（分钟）
    paymentTimeout: 30,
    // 退款原因选项
    refundReasons: [
      '行程有变，无法出行',
      '预订信息填写错误',
      '找到更优惠的价格',
      '其他原因',
    ],
  },

  // ========================
  // 表单配置
  // ========================
  forms: {
    // 证件类型
    idTypes: [
      { value: 1, label: '身份证' },
      { value: 2, label: '护照' },
      { value: 3, label: '港澳通行证' },
      { value: 4, label: '台湾通行证' },
    ],
  },
};
```

### 7.2 常量定义

```javascript
// config/constants.js

module.exports = {
  // ========================
  // 订单状态
  // ========================
  ORDER_STATUS: {
    PENDING_PAYMENT: 0,    // 待支付
    PENDING_CONFIRM: 1,    // 待确认
    CONFIRMED: 2,          // 已确认
    TRAVELLING: 3,         // 出行中
    COMPLETED: 4,          // 已完成
    CANCELLED: 5,          // 已取消
    REFUNDING: 6,          // 退款中
    REFUNDED: 7,           // 已退款
  },

  ORDER_STATUS_TEXT: {
    0: '待支付',
    1: '待确认',
    2: '已确认',
    3: '出行中',
    4: '已完成',
    5: '已取消',
    6: '退款中',
    7: '已退款',
  },

  // ========================
  // 推广员状态
  // ========================
  PROMOTER_STATUS: {
    PENDING: 0,      // 待审核
    APPROVED: 1,     // 已通过
    REJECTED: 2,     // 已拒绝
    DISABLED: 3,     // 已禁用
  },

  // ========================
  // 存储Key
  // ========================
  STORAGE_KEYS: {
    TOKEN: 'token',
    USER_INFO: 'userInfo',
    THEME: 'theme',
    SEARCH_HISTORY: 'searchHistory',
  },

  // ========================
  // 事件名称
  // ========================
  EVENTS: {
    LOGIN_SUCCESS: 'loginSuccess',
    LOGOUT: 'logout',
    ORDER_STATUS_CHANGE: 'orderStatusChange',
    FAVORITE_CHANGE: 'favoriteChange',
  },
};
```

---

## 八、开发规范

### 8.1 命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 文件夹 | 小写，连字符分隔 | `route-card`、`price-calendar` |
| 组件文件 | 小写 | `index.js`、`index.wxml` |
| 页面文件 | 小写 | `index.js`、`list.js` |
| JS变量 | 小驼峰 | `routeList`、`userInfo` |
| JS常量 | 大写下划线 | `ORDER_STATUS`、`API_BASE_URL` |
| CSS类名 | BEM规范 | `xj-btn`、`xj-btn--primary`、`xj-btn__icon` |
| CSS变量 | 小写连字符 | `--color-primary`、`--spacing-md` |

### 8.2 BEM命名规范

```css
/* Block（块）: 独立的组件 */
.xj-button { }

/* Element（元素）: 块的子元素，用双下划线连接 */
.xj-button__icon { }
.xj-button__text { }

/* Modifier（修饰符）: 状态或变体，用双连字符连接 */
.xj-button--primary { }
.xj-button--disabled { }
.xj-button--large { }

/* 组合使用 */
.xj-button--primary .xj-button__icon { }
```

### 8.3 代码风格

```javascript
// 1. 组件properties定义要完整
properties: {
  // 好的写法：有类型、默认值、注释
  /** 按钮类型 */
  type: {
    type: String,
    value: 'primary'
  },

  // 避免的写法：缺少默认值
  // type: String
}

// 2. 方法命名
methods: {
  // 事件处理用handle前缀
  handleTap() { },
  handleScroll() { },

  // 获取数据用get/fetch前缀
  getData() { },
  fetchList() { },

  // 更新数据用update/set前缀
  updateStatus() { },
  setLoading() { },
}

// 3. 避免在WXSS中写死颜色
/* 好的写法 */
.title { color: var(--color-text-primary); }

/* 避免的写法 */
.title { color: #333333; }
```

### 8.4 目录规范

```
pages/order/list/
├── index.js       # 页面逻辑
├── index.json     # 页面配置
├── index.wxml     # 页面结构
├── index.wxss     # 页面样式
└── components/    # 页面私有组件（可选）
    └── filter-bar/
```

---

## 九、后期UI美化指南

### 9.1 美化流程

```
1. UI设计师出设计稿
       ↓
2. 提取设计规范
   - 主色调、辅助色
   - 字号层级
   - 间距规范
   - 圆角规范
   - 阴影规范
       ↓
3. 更新 design-tokens.js
       ↓
4. 重新生成 variables.wxss
       ↓
5. 替换图标资源 (assets/icons/)
       ↓
6. 替换图片资源 (assets/images/)
       ↓
7. 微调个别组件样式（如需）
```

### 9.2 修改清单

| 需求 | 修改文件 | 操作 |
|------|---------|------|
| 更换主色调 | `config/design-tokens.js` | 修改 `colors.primary` |
| 更换全部配色 | `config/design-tokens.js` | 修改 `colors` 对象 |
| 更换字号体系 | `config/design-tokens.js` | 修改 `fonts` 对象 |
| 更换间距体系 | `config/design-tokens.js` | 修改 `spacing` 对象 |
| 更换圆角风格 | `config/design-tokens.js` | 修改 `radius` 对象 |
| 更换图标风格 | `assets/icons/` | 替换同名图片文件 |
| 更换空状态图 | `assets/images/empty/` | 替换同名图片文件 |
| 调整单个组件 | `components/xxx/index.wxss` | 修改组件样式 |

### 9.3 注意事项

1. **不要直接修改组件JS**：样式改动应只在wxss中完成
2. **保持文件名不变**：替换资源时保持原文件名
3. **测试所有页面**：修改Token后检查所有页面显示
4. **保留备份**：修改前备份原配置文件

---

## 十、与后端对接

### 10.1 API对应关系

| 前端页面 | 后端接口 | Controller |
|---------|---------|------------|
| 首页 | `/app/home/data` | HomeController |
| 线路列表 | `/app/route/list` | RouteController |
| 线路详情 | `/app/route/{id}` | RouteController |
| 订单确认 | `/app/order/confirm` | OrderController |
| 订单列表 | `/app/order/list` | OrderController |
| 我的信息 | `/app/user/info` | UserController |
| 推广员中心 | `/app/promoter/*` | PromoterController |

### 10.2 数据格式约定

```javascript
// 响应数据结构
{
  "code": 200,        // 状态码：200成功，其他失败
  "message": "success", // 提示信息
  "data": { }         // 业务数据
}

// 分页数据结构
{
  "code": 200,
  "data": {
    "list": [],       // 数据列表
    "total": 100,     // 总条数
    "page": 1,        // 当前页
    "pageSize": 10    // 每页条数
  }
}
```

---

## 附录A：组件清单

### 基础组件

| 组件 | 描述 | 属性 |
|-----|------|------|
| xj-button | 按钮 | type, size, block, disabled, loading |
| xj-input | 输入框 | type, placeholder, maxlength, disabled |
| xj-card | 卡片 | shadow, padding, radius, bordered |
| xj-tag | 标签 | type, size, plain, closable |
| xj-icon | 图标 | name, size, color |
| xj-image | 图片 | src, mode, lazy-load, placeholder |
| xj-empty | 空状态 | type, description |
| xj-loading | 加载 | type, size, text |
| xj-modal | 弹窗 | visible, title, showCancel |
| xj-toast | 轻提示 | type, message, duration |
| xj-popup | 弹出层 | position, visible, round |

### 业务组件

| 组件 | 描述 | 用途 |
|-----|------|------|
| route-card | 线路卡片 | 线路列表展示 |
| order-card | 订单卡片 | 订单列表展示 |
| traveler-form | 出行人表单 | 出行人信息填写 |
| price-calendar | 价格日历 | 线路价格日期选择 |
| date-picker | 日期选择 | 通用日期选择 |
| pay-panel | 支付面板 | 订单支付 |
| review-item | 评价项 | 评价展示 |

### 布局组件

| 组件 | 描述 | 用途 |
|-----|------|------|
| nav-bar | 导航栏 | 自定义顶部导航 |
| tab-bar | 底部栏 | 自定义底部Tab |
| page-container | 页面容器 | 统一页面布局 |
| safe-area | 安全区域 | 底部安全区域适配 |

---

## 附录B：页面清单

| 页面路径 | 描述 | 登录要求 |
|---------|------|---------|
| pages/index/index | 首页 | 否 |
| pages/login/index | 登录页 | 否 |
| pages/travel/index/index | 旅游页 | 否 |
| pages/route/list/index | 线路列表 | 否 |
| pages/route/detail/index | 线路详情 | 否 |
| pages/order/confirm/index | 订单确认 | 是 |
| pages/order/list/index | 订单列表 | 是 |
| pages/order/detail/index | 订单详情 | 是 |
| pages/order/refund/index | 退款申请 | 是 |
| pages/companion/list/index | 搭子列表 | 否 |
| pages/companion/detail/index | 搭子详情 | 否 |
| pages/trip/list/index | 行程列表 | 是 |
| pages/member/index/index | 会员中心 | 是 |
| pages/member/profile/index | 个人信息 | 是 |
| pages/member/travelers/index | 出行人管理 | 是 |
| pages/member/favorite/index | 我的收藏 | 是 |
| pages/member/coupon/index | 优惠券 | 是 |
| pages/promoter/apply/index | 推广员申请 | 是 |
| pages/promoter/center/index | 推广中心 | 是 |
| pages/message/list/index | 消息中心 | 是 |

---

## 附录C：登录流程设计

### C.1 登录流程概述

```
用户点击登录
    ↓
勾选用户协议
    ↓
微信一键登录 (wx.login获取code)
    ↓
后端返回 token + isNewUser
    ↓
┌─────────────────┬─────────────────┐
│    新用户        │    老用户        │
├─────────────────┼─────────────────┤
│ 完善头像昵称     │ 直接跳转回原页面  │
│      ↓          │                 │
│ 绑定手机号(可跳过)│                 │
│      ↓          │                 │
│ 登录成功跳转     │                 │
└─────────────────┴─────────────────┘
```

### C.2 页面结构

**页面路径**: `/pages/login/index`

| 步骤 | 名称 | 功能 |
|-----|------|------|
| Step 1 | 欢迎页 | Logo展示、微信一键登录按钮、用户协议勾选 |
| Step 2 | 完善信息 | 获取微信头像昵称（新用户） |
| Step 3 | 绑定手机号 | 微信一键获取或手动输入验证码绑定 |

### C.3 API接口

| 接口 | 方法 | 说明 | 请求参数 |
|------|------|------|---------|
| `/api/user/loginByCode` | POST | 微信登录 | `{ code }` |
| `/api/user/info` | GET | 获取用户信息 | - |
| `/api/user/info` | PUT | 更新用户信息 | `{ nickname, avatar, gender }` |
| `/api/user/bindPhoneByWx` | POST | 微信一键绑定手机号 | `{ code }` |
| `/api/user/bindPhone` | POST | 验证码绑定手机号 | `{ phone, code }` |
| `/api/user/sendCode` | POST | 发送验证码 | `{ phone }` |
| `/api/user/logout` | POST | 退出登录 | - |

### C.4 数据结构

**登录响应**
```json
{
  "code": 200,
  "data": {
    "userId": "123456",
    "token": "xxx",
    "isNewUser": true
  }
}
```

**用户信息**
```json
{
  "code": 200,
  "data": {
    "id": "123456",
    "nickname": "用户昵称",
    "avatar": "https://xxx/avatar.jpg",
    "phone": "138****8888",
    "gender": 1,
    "isMember": false,
    "isPromoter": false,
    "isLeader": false
  }
}
```

### C.5 页面数据

```javascript
// pages/login/index.js
data: {
  step: 1,           // 当前步骤：1-欢迎页 2-完善信息 3-绑定手机号
  agreed: false,     // 是否同意协议
  logging: false,    // 登录中
  isNewUser: false,  // 是否新用户
  userInfo: {
    avatar: '',
    nickname: '',
  },
  phone: '',         // 手机号
  verifyCode: '',    // 验证码
  countdown: 0,      // 倒计时
  canSkipPhone: true,// 是否可以跳过手机号绑定
  submitting: false, // 提交中
}
```

### C.6 UI示意

**步骤一：欢迎页**
```
┌─────────────────────────┐
│                         │
│         [Logo]          │
│       寻迹千行           │
│    发现旅途中的美好       │
│                         │
│  ┌───────────────────┐  │
│  │   微信一键登录      │  │
│  └───────────────────┘  │
│                         │
│  ☑ 我已阅读并同意        │
│    《用户协议》《隐私政策》│
│                         │
└─────────────────────────┘
```

**步骤二：完善信息**
```
┌─────────────────────────┐
│     完善个人信息         │
│  设置头像和昵称让大家认识你 │
│                         │
│  ┌─────────────────────┐│
│  │ 头像    [○] 点击更换 ││
│  ├─────────────────────┤│
│  │ 昵称    请输入昵称    ││
│  └─────────────────────┘│
│                         │
│  ┌───────────────────┐  │
│  │      下一步        │  │
│  └───────────────────┘  │
└─────────────────────────┘
```

**步骤三：绑定手机号**
```
┌─────────────────────────┐
│      绑定手机号          │
│   绑定手机号保障账号安全   │
│                         │
│  ┌───────────────────┐  │
│  │ 微信一键获取手机号  │  │
│  └───────────────────┘  │
│                         │
│  ────── 或手动输入 ────── │
│                         │
│  ┌─────────────────────┐│
│  │ 请输入手机号         ││
│  └─────────────────────┘│
│  ┌─────────────────────┐│
│  │ 请输入验证码  [获取]  ││
│  └─────────────────────┘│
│                         │
│  ┌───────────────────┐  │
│  │    绑定手机号      │  │
│  └───────────────────┘  │
│                         │
│        暂时跳过          │
└─────────────────────────┘
```

### C.7 相关文件

| 文件 | 说明 |
|------|------|
| `/pages/login/index.js` | 登录页面逻辑 |
| `/pages/login/index.wxml` | 登录页面模板 |
| `/pages/login/index.wxss` | 登录页面样式 |
| `/pages/login/index.json` | 登录页面配置 |
| `/services/user.js` | 用户API服务 |
| `/utils/auth.js` | 登录态管理工具 |
| `/config/api.js` | API路径配置 |

### C.8 后端接口（Java）

**UserController.java 新增接口：**

```java
// 微信一键绑定手机号
@PostMapping("/bindPhoneByWx")
public Result<Void> bindPhoneByWx(@RequestBody BindPhoneByWxRequest request);

// 验证码绑定手机号
@PostMapping("/bindPhone")
public Result<Void> bindPhone(@RequestBody BindPhoneRequest request);

// 发送验证码
@PostMapping("/sendCode")
public Result<Void> sendCode(@RequestBody SendCodeRequest request);
```

**注意事项：**
- 短信验证码功能需对接短信服务商（阿里云/腾讯云短信）
- 微信手机号获取需要微信小程序已认证

---

## 版本记录

| 版本 | 日期 | 更新内容 |
|-----|------|---------|
| V1.0 | 2026-01-25 | 初始版本 |
| V1.1 | 2026-01-26 | 新增登录流程设计（附录C） |
